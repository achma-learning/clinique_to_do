<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>üìã Observation M√©dicale</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.js"></script>
<style>
  :root {
    --blue: #1a5fa8;
    --blue-light: #e8f0fc;
    --blue-dark: #0d3d72;
    --green: #0a7c3e;
    --red: #c0392b;
    --orange: #e67e22;
    --gray: #6c757d;
    --border: #dee2e6;
    --bg: #ffffff;
    --section-bg: #f8faff;
    --text: #212529;
    --subtext: #495057;
    --radius: 12px;
    --shadow: 0 2px 8px rgba(26,95,168,0.10);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #eef2f7; color: var(--text); font-size: 16px; padding-bottom: 90px; }

  /* Header */
  .app-header { background: linear-gradient(135deg, var(--blue-dark), var(--blue)); color: white; text-align: center; padding: 20px 16px 16px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 12px rgba(0,0,0,0.2); }
  .app-header h1 { font-size: 1.3rem; font-weight: 700; letter-spacing: 0.5px; }
  .app-header p { font-size: 0.82rem; opacity: 0.85; margin-top: 4px; }
  .progress-bar-wrap { background: rgba(255,255,255,0.2); height: 5px; margin-top: 12px; border-radius: 3px; overflow: hidden; }
  .progress-bar { background: #7ecfff; height: 100%; width: 0%; transition: width 0.4s; border-radius: 3px; }

  /* Container */
  .container { max-width: 780px; margin: 0 auto; padding: 14px 12px; }

  /* Clinician card */
  .clinician-card { background: linear-gradient(135deg, #f0f4ff, #e8f0fc); border: 1.5px solid #b0c8e8; border-radius: var(--radius); padding: 16px 18px; margin-bottom: 14px; }
  .clinician-card .clinician-title { font-size: 0.78rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--blue); margin-bottom: 12px; }

  /* Section card */
  .section-card { background: var(--bg); border-radius: var(--radius); box-shadow: var(--shadow); margin-bottom: 14px; border: 1px solid var(--border); overflow: hidden; }
  .section-header { display: flex; align-items: center; padding: 16px 18px; cursor: pointer; user-select: none; background: var(--section-bg); gap: 12px; transition: background 0.2s; -webkit-tap-highlight-color: transparent; }
  .section-header:hover, .section-header:active { background: var(--blue-light); }
  .section-num { background: var(--blue); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 700; flex-shrink: 0; }
  .section-title { flex: 1; font-weight: 600; font-size: 1rem; color: var(--blue-dark); }
  .section-subtitle { font-size: 0.78rem; color: var(--gray); font-weight: 400; }
  .section-badge { background: var(--blue); color: white; font-size: 0.7rem; font-weight: 700; padding: 3px 8px; border-radius: 20px; white-space: nowrap; }
  .section-badge.done { background: var(--green); }
  .toggle-icon { font-size: 1.4rem; color: var(--blue); font-weight: 300; transition: transform 0.25s; width: 24px; text-align: center; flex-shrink: 0; }
  .toggle-icon.open { transform: rotate(45deg); }
  .section-body { display: none; padding: 18px; border-top: 1px solid var(--border); }
  .section-body.open { display: block; }

  /* Sub-sections */
  .subsection { margin-top: 16px; padding-left: 14px; border-left: 3px solid var(--blue); }
  .subsection-title { font-size: 0.88rem; font-weight: 700; color: var(--blue); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.3px; }
  .subsubsection { margin-top: 10px; margin-left: 10px; padding-left: 10px; border-left: 2px solid #b0c8e8; }
  .subsubsection-title { font-size: 0.82rem; font-weight: 600; color: var(--subtext); margin-bottom: 8px; }

  /* Form fields */
  .field-group { margin-bottom: 14px; }
  .field-label { display: block; font-size: 0.82rem; font-weight: 600; color: var(--subtext); margin-bottom: 5px; }
  .field-input { width: 100%; padding: 11px 13px; border: 1.5px solid var(--border); border-radius: 8px; font-size: 0.95rem; color: var(--text); background: #fff; transition: border-color 0.2s; -webkit-appearance: none; }
  .field-input:focus { outline: none; border-color: var(--blue); box-shadow: 0 0 0 3px rgba(26,95,168,0.12); }
  textarea.field-input { resize: vertical; min-height: 70px; font-family: inherit; }
  select.field-input { cursor: pointer; }
  .field-input[readonly] { background: #f0f4ff; color: var(--gray); }

  /* Checkboxes */
  .check-list { display: flex; flex-direction: column; gap: 4px; }
  .check-item { display: flex; align-items: flex-start; gap: 12px; padding: 10px 12px; border-radius: 8px; cursor: pointer; transition: background 0.15s; -webkit-tap-highlight-color: transparent; min-height: 44px; }
  .check-item:hover { background: var(--blue-light); }
  .check-item:active { background: #d0e3ff; }
  .check-item input[type="checkbox"] { width: 24px; height: 24px; min-width: 24px; border-radius: 5px; border: 2px solid #aaa; cursor: pointer; margin-top: 1px; accent-color: var(--blue); flex-shrink: 0; }
  .check-item span { font-size: 0.93rem; color: var(--text); line-height: 1.45; padding-top: 2px; }
  .check-item input[type="checkbox"]:checked ~ span { color: var(--green); font-weight: 500; }

  /* Row layouts */
  .fields-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .fields-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
  @media (max-width: 480px) { .fields-row, .fields-row-3 { grid-template-columns: 1fr 1fr; } }

  /* Divider */
  .divider { border: none; border-top: 1px dashed var(--border); margin: 14px 0; }

  /* Note box */
  .note-box { background: var(--blue-light); border-left: 4px solid var(--blue); border-radius: 6px; padding: 10px 12px; font-size: 0.82rem; color: var(--blue-dark); margin-bottom: 14px; }

  /* ECOG badge */
  .ecog-preview { display: inline-block; margin-top: 6px; padding: 4px 10px; border-radius: 20px; font-size: 0.78rem; font-weight: 700; }
  .ecog-0 { background: #d4edda; color: #155724; }
  .ecog-1 { background: #d1ecf1; color: #0c5460; }
  .ecog-2 { background: #fff3cd; color: #856404; }
  .ecog-3 { background: #fde8e8; color: #721c24; }
  .ecog-4 { background: #f5c6cb; color: #491217; }

  /* Hypothesis / Diagnostic table */
  .diag-table-wrap { overflow-x: auto; margin-top: 10px; }
  .diag-table { width: 100%; border-collapse: collapse; background: white; font-size: 0.88rem; }
  .diag-table th { background: var(--blue); color: white; padding: 10px 12px; text-align: left; font-weight: 700; font-size: 0.82rem; white-space: nowrap; }
  .diag-table td { border: 1px solid #d0dff0; padding: 0; vertical-align: top; min-width: 130px; }
  .diag-table td textarea { width: 100%; min-height: 80px; border: none; padding: 9px 10px; resize: vertical; font-family: inherit; font-size: 0.87rem; background: transparent; outline: none; color: var(--text); }
  .diag-table td textarea:focus { background: #f0f8ff; }
  .diag-table .row-num { width: 32px; text-align: center; font-weight: 700; color: var(--blue-dark); font-size: 0.82rem; padding: 8px 4px; background: #f0f4ff; border: 1px solid #d0dff0; }
  .diag-table .del-cell { width: 34px; text-align: center; padding: 6px 4px; background: #fff8f8; border: 1px solid #d0dff0; }
  .del-btn { background: none; border: none; color: #cc3333; font-size: 1.1rem; cursor: pointer; padding: 4px; border-radius: 4px; line-height: 1; }
  .del-btn:hover { background: #fee; }
  .add-row-btn { margin-top: 8px; padding: 8px 16px; background: white; border: 1.5px solid var(--blue); color: var(--blue); border-radius: 8px; font-size: 0.85rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: background 0.15s; }
  .add-row-btn:hover { background: var(--blue-light); }

  /* Sticky bar */
  .sticky-bar { position: fixed; bottom: 0; left: 0; right: 0; z-index: 200; background: white; padding: 10px 14px; box-shadow: 0 -3px 16px rgba(0,0,0,0.13); display: flex; gap: 10px; }
  .btn { flex: 1; padding: 13px 10px; border: none; border-radius: 10px; font-size: 0.92rem; font-weight: 700; cursor: pointer; transition: opacity 0.2s, transform 0.1s; display: flex; align-items: center; justify-content: center; gap: 6px; -webkit-tap-highlight-color: transparent; }
  .btn:active { transform: scale(0.97); }
  .btn-primary { background: var(--blue); color: white; }
  .btn-primary:hover { background: var(--blue-dark); }
  .btn-success { background: var(--green); color: white; }
  .btn-success:hover { background: #085c2e; }
  .btn-danger { background: var(--red); color: white; }
  .btn-danger:hover { background: #a93226; }
  .btn:disabled { opacity: 0.55; cursor: not-allowed; }

  /* Toast */
  #toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #222; color: white; padding: 10px 22px; border-radius: 20px; font-size: 0.87rem; z-index: 300; opacity: 0; transition: opacity 0.3s; pointer-events: none; white-space: nowrap; }
  #toast.show { opacity: 1; }

  /* Top actions */
  .top-actions { display: flex; gap: 10px; margin-bottom: 14px; flex-wrap: wrap; }
  .top-btn { padding: 8px 14px; border-radius: 8px; border: 1.5px solid var(--blue); background: white; color: var(--blue); font-size: 0.83rem; font-weight: 600; cursor: pointer; flex: 1; text-align: center; transition: background 0.15s; }
  .top-btn:hover { background: var(--blue-light); }

  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-thumb { background: #c0d0e8; border-radius: 3px; }
</style>
</head>
<body>

<div class="app-header">
  <h1>üìã Observation M√©dicale</h1>
  <p>M√©decine G√©n√©rale ¬∑ Saisie ¬∑ Checklist ¬∑ Export Word</p>
  <div class="progress-bar-wrap"><div class="progress-bar" id="progressBar"></div></div>
</div>

<div id="toast"></div>

<div class="container">
  <div class="top-actions">
    <button class="top-btn" onclick="expandAll()">‚¨á Tout ouvrir</button>
    <button class="top-btn" onclick="collapseAll()">‚¨Ü Tout fermer</button>
  </div>

  <!-- ‚ïê‚ïê‚ïê CLINICIEN ‚ïê‚ïê‚ïê -->
  <div class="clinician-card">
    <div class="clinician-title">üë®‚Äç‚öïÔ∏è Informations du Clinicien</div>
    <div class="fields-row">
      <div class="field-group">
        <label class="field-label">Nom du clinicien</label>
        <input type="text" name="clinicien_nom" class="field-input" placeholder="Dr. Nom Pr√©nom" oninput="updateProgress()">
      </div>
      <div class="field-group">
        <label class="field-label">Fonction</label>
        <select name="clinicien_fonction" class="field-input" onchange="updateProgress()">
          <option value="">‚Äî</option>
          <option value="Externe">Externe</option>
          <option value="Interne">Interne</option>
          <option value="R√©sident">R√©sident</option>
          <option value="M√©decin g√©n√©raliste">M√©decin g√©n√©raliste</option>
          <option value="M√©decin sp√©cialiste">M√©decin sp√©cialiste</option>
          <option value="Professeur assistant">Professeur assistant</option>
          <option value="Professeur agr√©g√©">Professeur agr√©g√©</option>
          <option value="Professeur de l'enseignement sup√©rieur">Professeur de l'enseignement sup√©rieur</option>
          <option value="Infirmier">Infirmier</option>
          <option value="Sage-femme">Sage-femme</option>
          <option value="Pharmacien">Pharmacien</option>
          <option value="Chirurgien-dentiste">Chirurgien-dentiste</option>
          <option value="Kin√©sith√©rapeute">Kin√©sith√©rapeute</option>
          <option value="Orthophoniste">Orthophoniste</option>
          <option value="Psychologue">Psychologue</option>
          <option value="Technicien de laboratoire">Technicien de laboratoire</option>
          <option value="Technicien en radiologie">Technicien en radiologie</option>
          <option value="Aide-soignant">Aide-soignant</option>
          <option value="Autre professionnel de sant√©">Autre professionnel de sant√©</option>
        </select>
      </div>
    </div>
    <div class="fields-row">
      <div class="field-group">
        <label class="field-label">Date de l'observation</label>
        <input type="date" name="obs_date" class="field-input" oninput="updateProgress()">
      </div>
      <div class="field-group">
        <label class="field-label">Heure</label>
        <input type="time" name="obs_heure" class="field-input" oninput="updateProgress()">
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê 1. IDENTIT√â ‚ïê‚ïê‚ïê -->
  <div class="section-card">
    <div class="section-header" onclick="toggleSection(this)">
      <div class="section-num">1</div>
      <div class="section-title">Identit√© du Patient<div class="section-subtitle">Anamn√®se administrative</div></div>
      <span class="section-badge" id="badge-1">‚Äî</span>
      <span class="toggle-icon">+</span>
    </div>
    <div class="section-body">
      <div class="fields-row">
        <div class="field-group">
          <label class="field-label">Nom et Pr√©nom</label>
          <input type="text" name="nom_prenom" class="field-input" placeholder="Nom Pr√©nom" oninput="updateProgress()">
        </div>
        <div class="field-group">
          <label class="field-label">Date de naissance</label>
          <input type="date" name="date_naissance" class="field-input" oninput="calcAgeFromDOB(); updateProgress()">
        </div>
      </div>
      <div class="fields-row">
        <div class="field-group">
          <label class="field-label">√Çge <span style="color:#888;font-weight:400;">(auto-calcul√© si DDN renseign√©e)</span></label>
          <input type="text" name="age" id="age_field" class="field-input" placeholder="ex: 45 ans" oninput="calcDOBFromAge(); updateProgress()">
        </div>
        <div class="field-group">
          <label class="field-label">Sexe</label>
          <select name="sexe" class="field-input" onchange="updateProgress()">
            <option value="">‚Äî</option>
            <option value="Masculin">Masculin</option>
            <option value="F√©minin">F√©minin</option>
          </select>
        </div>
      </div>
      <div class="fields-row">
        <div class="field-group">
          <label class="field-label">Situation familiale</label>
          <select name="situation_familiale" class="field-input" onchange="updateProgress()">
            <option value="">‚Äî</option>
            <option value="C√©libataire">C√©libataire</option>
            <option value="Mari√©(e)">Mari√©(e)</option>
            <option value="Divorc√©(e)">Divorc√©(e)</option>
            <option value="Veuf(ve)">Veuf(ve)</option>
          </select>
        </div>
        <div class="field-group">
          <label class="field-label">Nombre d'enfants</label>
          <input type="number" name="nb_enfants" class="field-input" placeholder="0" min="0" oninput="updateProgress()">
        </div>
      </div>
      <div class="fields-row">
        <div class="field-group">
          <label class="field-label">Originaire de</label>
          <input type="text" name="originaire_de" class="field-input" placeholder="Ville / r√©gion d'origine" oninput="updateProgress()">
        </div>
        <div class="field-group">
          <label class="field-label">R√©sidant √†</label>
          <input type="text" name="residant_a" class="field-input" placeholder="Ville / adresse actuelle" oninput="updateProgress()">
        </div>
      </div>
      <div class="field-group">
        <label class="field-label">Profession</label>
        <input type="text" name="profession" class="field-input" placeholder="Profession actuelle" oninput="updateProgress()">
      </div>
      <div class="field-group">
        <label class="field-label">Couverture sociale / Mutuelle</label>
        <select name="couverture_sociale" class="field-input" onchange="updateProgress()">
          <option value="">‚Äî</option>
          <optgroup label="AMO ‚Äì Couverture de base">
            <option value="AMO CNSS (secteur priv√©)">AMO CNSS (secteur priv√©)</option>
            <option value="AMO CNOPS (secteur public)">AMO CNOPS (secteur public)</option>
            <option value="AMO Achamil (TNS)">AMO Achamil (TNS)</option>
            <option value="AMO Tadamon (ex-RAMED)">AMO Tadamon (ex-RAMED)</option>
            <option value="AMO √âtudiants">AMO √âtudiants</option>
          </optgroup>
          <optgroup label="R√©gimes sp√©cifiques">
            <option value="FAR ‚Äì R√©gime Militaire">FAR ‚Äì R√©gime Militaire</option>
          </optgroup>
          <optgroup label="Mutuelles">
            <option value="MGPAP">MGPAP</option>
            <option value="MGEN">MGEN</option>
            <option value="MGPTT">MGPTT</option>
            <option value="Autres mutuelles sectorielles">Autres mutuelles sectorielles</option>
          </optgroup>
          <optgroup label="Assurances priv√©es">
            <option value="SANLAM">SANLAM</option><option value="AXA">AXA</option>
            <option value="Allianz">Allianz</option><option value="Wafa Assurance">Wafa Assurance</option>
            <option value="AtlantaSanad">AtlantaSanad</option><option value="RMA">RMA</option>
          </optgroup>
          <option value="Aucune">Aucune</option>
        </select>
      </div>

      <hr class="divider">

      <!-- Contact + Personne de confiance -->
      <div class="subsection">
        <div class="subsection-title">üìû Contacts</div>
        <div class="fields-row">
          <div class="field-group">
            <label class="field-label">Type de contact</label>
            <select name="contact_type" class="field-input" onchange="updateProgress()">
              <option value="">‚Äî</option>
              <option value="Patient lui-m√™me">Patient lui-m√™me</option>
              <option value="Famille">Famille</option>
              <option value="Contact d'urgence">Contact d'urgence</option>
              <option value="Tuteur l√©gal">Tuteur l√©gal</option>
            </select>
          </div>
          <div class="field-group">
            <label class="field-label">Num√©ro de contact / urgence</label>
            <input type="tel" name="contact_numero" class="field-input" placeholder="+212 6XX XXX XXX" oninput="updateProgress()">
          </div>
        </div>
        <div class="fields-row">
          <div class="field-group">
            <label class="field-label">Personne de confiance ‚Äì Nom</label>
            <input type="text" name="confiance_nom" class="field-input" placeholder="Nom de la personne de confiance" oninput="updateProgress()">
          </div>
          <div class="field-group">
            <label class="field-label">Personne de confiance ‚Äì Contact</label>
            <input type="tel" name="confiance_contact" class="field-input" placeholder="+212 6XX XXX XXX" oninput="updateProgress()">
          </div>
        </div>
      </div>

      <hr class="divider">

      <!-- Autonomie + ECOG -->
      <div class="fields-row">
        <div class="field-group">
          <label class="field-label">Autonomie</label>
          <select name="autonomie" class="field-input" onchange="updateProgress()">
            <option value="">‚Äî</option>
            <option value="Totalement autonome">Totalement autonome</option>
            <option value="Partiellement autonome">Partiellement autonome</option>
            <option value="D√©pendant(e)">D√©pendant(e)</option>
          </select>
        </div>
        <div class="field-group">
          <label class="field-label">PS OMS / Score ECOG</label>
          <select name="ecog_score" class="field-input" onchange="showEcog(); updateProgress()">
            <option value="">‚Äî</option>
            <option value="0">PS 0 ‚Äì Activit√© normale, sans restriction</option>
            <option value="1">PS 1 ‚Äì Activit√© physique intense restreinte, ambulatoire</option>
            <option value="2">PS 2 ‚Äì Ambulatoire, capable de se soigner, incapable de travailler, debout &gt;50% du temps</option>
            <option value="3">PS 3 ‚Äì Limit√© dans l'auto-soin, alit√© ou en chaise &gt;50% du temps</option>
            <option value="4">PS 4 ‚Äì Totalement invalide, alit√© √† 100%</option>
          </select>
          <div id="ecog_preview" style="margin-top:6px;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê 2. MOTIF DE CONSULTATION ‚ïê‚ïê‚ïê -->
  <div class="section-card">
    <div class="section-header" onclick="toggleSection(this)">
      <div class="section-num">2</div>
      <div class="section-title">Motif de Consultation<div class="section-subtitle">MDC ‚Äî en mots propres du patient</div></div>
      <span class="section-badge" id="badge-2">‚Äî</span>
      <span class="toggle-icon">+</span>
    </div>
    <div class="section-body">
      <div class="note-box">üí° C'est un signe fonctionnel, jamais un diagnostic √† ce stade.</div>
      <div class="field-group">
        <label class="field-label">Plainte principale (mots du patient)</label>
        <textarea name="plainte_principale" class="field-input" placeholder="Ex : ¬´ J'ai mal au ventre depuis 3 jours... ¬ª" oninput="updateProgress()"></textarea>
      </div>
      <div class="field-group">
        <label class="field-label">Date de d√©but des sympt√¥mes</label>
        <input type="date" name="date_debut_symptomes" class="field-input" oninput="updateProgress()">
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê 3. ANT√âC√âDENTS ‚ïê‚ïê‚ïê -->
  <div class="section-card">
    <div class="section-header" onclick="toggleSection(this)">
      <div class="section-num">3</div>
      <div class="section-title">Ant√©c√©dents (ATCD)<div class="section-subtitle">Personnels et familiaux</div></div>
      <span class="section-badge" id="badge-3">‚Äî</span>
      <span class="toggle-icon">+</span>
    </div>
    <div class="section-body">

      <!-- Ant√©c√©dents Personnels -->
      <div class="subsection">
        <div class="subsection-title">A. Ant√©c√©dents Personnels</div>

        <div class="subsubsection">
          <div class="subsubsection-title">1. M√©dicaux</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="atcd_diabete" onchange="updateProgress()"><span>Diab√®te (Type 1 / 2 / gestationnel)</span></label>
            <label class="check-item"><input type="checkbox" name="atcd_hta" onchange="updateProgress()"><span>Hypertension Art√©rielle (HTA)</span></label>
            <label class="check-item"><input type="checkbox" name="atcd_asthme" onchange="updateProgress()"><span>Asthme</span></label>
            <label class="check-item"><input type="checkbox" name="atcd_ulcere" onchange="updateProgress()"><span>Ulc√®re gastro-duod√©nal</span></label>
            <label class="check-item"><input type="checkbox" name="atcd_tuberculose" onchange="updateProgress()"><span>Tuberculose</span></label>
            <label class="check-item"><input type="checkbox" name="atcd_mst" onchange="updateProgress()"><span>MST (Nature, type, dur√©e du traitement)</span></label>
            <label class="check-item"><input type="checkbox" name="atcd_hospitalisations" onchange="updateProgress()"><span>Hospitalisations ant√©rieures</span></label>
          </div>
          <div class="field-group" style="margin-top:10px;">
            <label class="field-label">Pr√©cisions maladies chroniques / hospitalisations</label>
            <textarea name="atcd_medicaux_details" class="field-input" placeholder="Motif, date, dur√©e, lieu‚Ä¶" oninput="updateProgress()"></textarea>
          </div>
        </div>

        <div class="subsubsection">
          <div class="subsubsection-title">2. Chirurgicaux</div>
          <div class="fields-row">
            <div class="field-group">
              <label class="field-label">Type d'intervention</label>
              <input type="text" name="atcd_chir_type" class="field-input" placeholder="Ex: appendicectomie" oninput="updateProgress()">
            </div>
            <div class="field-group">
              <label class="field-label">Date</label>
              <input type="date" name="atcd_chir_date" class="field-input" oninput="updateProgress()">
            </div>
          </div>
          <div class="fields-row">
            <div class="field-group">
              <label class="field-label">Lieu</label>
              <input type="text" name="atcd_chir_lieu" class="field-input" placeholder="√âtablissement" oninput="updateProgress()">
            </div>
            <div class="field-group">
              <label class="field-label">Complications</label>
              <input type="text" name="atcd_chir_complications" class="field-input" placeholder="Infections, phl√©bite‚Ä¶" oninput="updateProgress()">
            </div>
          </div>
        </div>

        <div class="subsubsection">
          <div class="subsubsection-title">3. Toxico-Allergiques</div>
          <div class="fields-row">
            <div class="field-group">
              <label class="field-label">Tabagisme</label>
              <select name="atcd_tabagisme_statut" class="field-input" onchange="updateProgress()">
                <option value="">‚Äî</option>
                <option value="Non fumeur">Non fumeur</option>
                <option value="Fumeur actif">Fumeur actif</option>
                <option value="Tabagisme passif">Tabagisme passif</option>
                <option value="Sevr√© >3 ans">Sevr√© &gt; 3 ans</option>
              </select>
            </div>
            <div class="field-group">
              <label class="field-label">Paquets-ann√©es (PA)</label>
              <input type="text" name="atcd_tabagisme_pa" class="field-input" placeholder="Ex: 20 PA" oninput="updateProgress()">
            </div>
          </div>
          <div class="field-group">
            <label class="field-label">Alcool / Drogues</label>
            <input type="text" name="atcd_alcool_drogues" class="field-input" placeholder="Type, quantit√©, fr√©quence" oninput="updateProgress()">
          </div>
          <div class="field-group">
            <label class="field-label">Allergies</label>
            <textarea name="atcd_allergies" class="field-input" placeholder="M√©dicamenteuses, alimentaires, environnementales ‚Äì r√©action d√©crite" oninput="updateProgress()"></textarea>
          </div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="atcd_contact_animaux" onchange="updateProgress()"><span>Contact avec animaux (chiens, oiseaux, bovins‚Ä¶)</span></label>
          </div>
        </div>

        <div class="subsubsection">
          <div class="subsubsection-title">4. Traitements en cours</div>
          <div class="field-group">
            <label class="field-label">M√©dicaments (3 derniers mois)</label>
            <textarea name="atcd_traitements" class="field-input" placeholder="Nom, posologie, horaire‚Ä¶" oninput="updateProgress()"></textarea>
          </div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="atcd_verif_ordonnances" onchange="updateProgress()"><span>Ordonnances v√©rifi√©es</span></label>
          </div>
        </div>

        <div class="subsubsection">
          <div class="subsubsection-title">5. Vaccination</div>
          <div class="field-group">
            <label class="field-label">Statut vaccinal</label>
            <textarea name="atcd_vaccination" class="field-input" placeholder="Carnet de vaccination, vaccins √† jour‚Ä¶" oninput="updateProgress()"></textarea>
          </div>
        </div>

        <div class="subsubsection">
          <div class="subsubsection-title">6. Gyn√©co-Obst√©triques <span style="font-weight:400;color:#888;">(femme)</span></div>
          <div class="fields-row">
            <div class="field-group">
              <label class="field-label">DDR</label>
              <input type="date" name="atcd_ddr" class="field-input" oninput="updateProgress()">
            </div>
            <div class="field-group">
              <label class="field-label">Gestit√© / Parit√©</label>
              <input type="text" name="atcd_gestite_parite" class="field-input" placeholder="G3 P2" oninput="updateProgress()">
            </div>
          </div>
          <div class="fields-row">
            <div class="field-group">
              <label class="field-label">R√©gularit√© des cycles</label>
              <select name="atcd_cycles" class="field-input" onchange="updateProgress()">
                <option value="">‚Äî</option>
                <option value="R√©guliers">R√©guliers</option>
                <option value="Irr√©guliers">Irr√©guliers</option>
                <option value="M√©nopaus√©e">M√©nopaus√©e</option>
              </select>
            </div>
            <div class="field-group">
              <label class="field-label">Contraception</label>
              <select name="atcd_contraception" class="field-input" onchange="updateProgress()">
                <option value="">‚Äî S√©lectionnez une m√©thode ‚Äî</option>
                <optgroup label="üíä Contraceptifs hormonaux oraux">
                  <option value="Contraceptifs oraux combin√©s (≈ìstroprogestatifs)">1 ‚Äì Contraceptifs oraux combin√©s (≈ìstroprogestatifs)</option>
                  <option value="Pilules micro-progestatives">2 ‚Äì Pilules micro-progestatives</option>
                </optgroup>
                <optgroup label="üíâ Contraceptifs injectables et implants">
                  <option value="Progestatifs injectables">3 ‚Äì Progestatifs injectables</option>
                  <option value="Implants contraceptifs">4 ‚Äì Implants contraceptifs</option>
                </optgroup>
                <optgroup label="üî© Dispositifs intra-ut√©rins (DIU)">
                  <option value="DIU au cuivre (non hormonal)">5 ‚Äì DIU au cuivre (non hormonal)</option>
                  <option value="DIU hormonal (st√©rilet hormonal)">5 ‚Äì DIU hormonal (st√©rilet hormonal)</option>
                </optgroup>
                <optgroup label="üÜò Contraception d'urgence">
                  <option value="Pilule du lendemain (contraception d'urgence)">6 ‚Äì Pilule du lendemain</option>
                </optgroup>
                <optgroup label="‚úÇÔ∏è M√©thodes chirurgicales d√©finitives">
                  <option value="Ligature des trompes">7 ‚Äì Ligature des trompes</option>
                </optgroup>
                <optgroup label="üîµ Autres m√©thodes">
                  <option value="Pr√©servatif masculin">8 ‚Äì Pr√©servatif masculin</option>
                  <option value="Anneau intra-vaginal et patch contraceptif">8 ‚Äì Anneau intra-vaginal et patch contraceptif</option>
                  <option value="Spermicides">8 ‚Äì Spermicides</option>
                  <option value="Diaphragme">8 ‚Äì Diaphragme</option>
                  <option value="M√©thodes naturelles">8 ‚Äì M√©thodes naturelles</option>
                  <option value="M√©thode de l'allaitement maternel et de l'am√©norrh√©e (MAMA)">8 ‚Äì MAMA</option>
                  <option value="Co√Øt interrompu">8 ‚Äì Co√Øt interrompu</option>
                </optgroup>
                <option value="Aucune">Aucune</option>
              </select>
            </div>
          </div>
          <div class="field-group">
            <label class="field-label">Complications obst√©tricales</label>
            <textarea name="atcd_gyn_complications" class="field-input" placeholder="Fausses couches, c√©sarienne, HTA gravidique‚Ä¶" oninput="updateProgress()"></textarea>
          </div>
        </div>
      </div>

      <!-- Ant√©c√©dents Familiaux -->
      <div class="subsection" style="margin-top:16px;">
        <div class="subsection-title">B. Ant√©c√©dents Familiaux (premier degr√©)</div>
        <div class="check-list">
          <label class="check-item"><input type="checkbox" name="atcd_fam_diabete" onchange="updateProgress()"><span>Diab√®te familial</span></label>
          <label class="check-item"><input type="checkbox" name="atcd_fam_hta" onchange="updateProgress()"><span>HTA familiale</span></label>
          <label class="check-item"><input type="checkbox" name="atcd_fam_cancer" onchange="updateProgress()"><span>Cancer familial</span></label>
          <label class="check-item"><input type="checkbox" name="atcd_fam_cardio" onchange="updateProgress()"><span>Maladies cardiaques familiales</span></label>
          <label class="check-item"><input type="checkbox" name="atcd_fam_contage_tb" onchange="updateProgress()"><span>Notion de contage tuberculeux</span></label>
        </div>
        <div class="field-group" style="margin-top:10px;">
          <label class="field-label">Autres maladies h√©r√©ditaires / d√©c√®s familiaux</label>
          <textarea name="atcd_fam_autres" class="field-input" placeholder="Pr√©ciser‚Ä¶" oninput="updateProgress()"></textarea>
        </div>
      </div>

    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê 4. HISTOIRE DE LA MALADIE ‚ïê‚ïê‚ïê -->
  <div class="section-card">
    <div class="section-header" onclick="toggleSection(this)">
      <div class="section-num">4</div>
      <div class="section-title">Histoire de la Maladie<div class="section-subtitle">HDM ‚Äî Chronologie & SITI FADMA</div></div>
      <span class="section-badge" id="badge-4">‚Äî</span>
      <span class="toggle-icon">+</span>
    </div>
    <div class="section-body">
      <div class="field-group">
        <label class="field-label">Chronologie / D√©but</label>
        <textarea name="hdM_chronologie" class="field-input" placeholder="Ex: depuis 3 semaines, apparu brutalement le‚Ä¶" oninput="updateProgress()"></textarea>
      </div>
      <div class="field-group">
        <label class="field-label">Mode d'installation</label>
        <select name="hdM_mode_installation" class="field-input" onchange="updateProgress()">
          <option value="">‚Äî</option>
          <option value="Brutal">Brutal (quelques minutes)</option>
          <option value="Progressif">Progressif (heures √† jours)</option>
          <option value="Insidieux">Insidieux (semaines √† mois)</option>
        </select>
      </div>
      <div class="subsection">
        <div class="subsection-title">Caract√©risation : SITI FADMA</div>
        <div class="subsubsection"><div class="subsubsection-title">S ‚Äì Si√®ge</div>
          <input type="text" name="hdM_siege" class="field-input" placeholder="Localisation anatomique pr√©cise" oninput="updateProgress()"></div>
        <div class="subsubsection"><div class="subsubsection-title">I ‚Äì Irradiation</div>
          <input type="text" name="hdM_irradiation" class="field-input" placeholder="Vers quelle r√©gion ?" oninput="updateProgress()"></div>
        <div class="subsubsection"><div class="subsubsection-title">T ‚Äì Type</div>
          <input type="text" name="hdM_type" class="field-input" placeholder="Br√ªlure, torsion, pesanteur, crampe‚Ä¶" oninput="updateProgress()"></div>
        <div class="subsubsection"><div class="subsubsection-title">I ‚Äì Impact / Intensit√©</div>
          <div class="fields-row">
            <input type="text" name="hdM_impact" class="field-input" placeholder="Retentissement sur la vie" oninput="updateProgress()">
            <input type="number" name="hdM_eva" class="field-input" placeholder="EVA /10" min="0" max="10" oninput="updateProgress()">
          </div></div>
        <div class="subsubsection"><div class="subsubsection-title">F ‚Äì Facteurs aggravants / calmants</div>
          <input type="text" name="hdM_facteurs_aggravants" class="field-input" placeholder="Ce qui aggrave / soulage" oninput="updateProgress()"></div>
        <div class="subsubsection"><div class="subsubsection-title">A ‚Äì Accalmie</div>
          <input type="text" name="hdM_accalmie" class="field-input" placeholder="P√©riodes de r√©mission" oninput="updateProgress()"></div>
        <div class="subsubsection"><div class="subsubsection-title">D ‚Äì Dur√©e / Rythme</div>
          <input type="text" name="hdM_duree_rythme" class="field-input" placeholder="Dur√©e des crises, fr√©quence‚Ä¶" oninput="updateProgress()"></div>
        <div class="subsubsection"><div class="subsubsection-title">M ‚Äì Mode √©volutif</div>
          <select name="hdM_mode_evolutif" class="field-input" onchange="updateProgress()">
            <option value="">‚Äî</option>
            <option value="Stable">Stable</option>
            <option value="R√©gressif">R√©gressif</option>
            <option value="Progressif (s'aggrave)">Progressif (s'aggrave)</option>
            <option value="R√©cidivant">R√©cidivant</option>
            <option value="Ondulatoire">Ondulatoire</option>
          </select></div>
        <div class="subsubsection"><div class="subsubsection-title">A ‚Äì Am√©lioration sous traitement</div>
          <input type="text" name="hdM_evolution_traitement" class="field-input" placeholder="R√©ponse aux traitements ant√©rieurs" oninput="updateProgress()"></div>
      </div>
      <div class="subsection">
        <div class="subsection-title">Signes g√©n√©raux (3A + Fi√®vre)</div>
        <div class="check-list">
          <label class="check-item"><input type="checkbox" name="hdM_asthenie" onchange="updateProgress()"><span>Asth√©nie</span></label>
          <label class="check-item"><input type="checkbox" name="hdM_anorexie" onchange="updateProgress()"><span>Anorexie</span></label>
          <label class="check-item"><input type="checkbox" name="hdM_fievre" onchange="updateProgress()"><span>Fi√®vre</span></label>
          <label class="check-item"><input type="checkbox" name="hdM_frissons" onchange="updateProgress()"><span>Frissons</span></label>
          <label class="check-item"><input type="checkbox" name="hdM_sueurs_nocturnes" onchange="updateProgress()"><span>Sueurs nocturnes</span></label>
        </div>
        <div class="field-group" style="margin-top:10px;">
          <label class="field-label">Amaigrissement</label>
          <input type="text" name="hdM_amaigrissement" class="field-input" placeholder="Ex: ‚àí5 kg en 2 mois" oninput="updateProgress()">
        </div>
      </div>
      <div class="field-group">
        <label class="field-label">Signes associ√©s</label>
        <textarea name="hdM_signes_associes" class="field-input" placeholder="Naus√©es, vomissements, dyspn√©e, palpitations‚Ä¶" oninput="updateProgress()"></textarea>
      </div>
      <div class="field-group">
        <label class="field-label">Signes n√©gatifs importants</label>
        <textarea name="hdM_signes_negatifs" class="field-input" placeholder="Signes absents mais pertinents √† noter‚Ä¶" oninput="updateProgress()"></textarea>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê 5. EXAMEN CLINIQUE ‚ïê‚ïê‚ïê -->
  <div class="section-card">
    <div class="section-header" onclick="toggleSection(this)">
      <div class="section-num">5</div>
      <div class="section-title">Examen Clinique<div class="section-subtitle">Examen physique complet</div></div>
      <span class="section-badge" id="badge-5">‚Äî</span>
      <span class="toggle-icon">+</span>
    </div>
    <div class="section-body">

      <!-- 5.1 Examen G√©n√©ral/Vital -->
      <div class="subsection">
        <div class="subsection-title">5.1 ‚Äî Examen G√©n√©ral/Vital &amp; Constantes</div>
        <div class="check-list">
          <label class="check-item"><input type="checkbox" name="eg_conscient_oriente" onchange="updateProgress()"><span>Conscient et orient√© dans le temps et l'espace</span></label>
          <label class="check-item"><input type="checkbox" name="eg_stable_hemo_respi" onchange="updateProgress()"><span>Stable sur le plan h√©modynamique et respiratoire</span></label>
        </div>
        <div class="subsubsection">
          <div class="subsubsection-title">Conjonctif normocolor√© ?</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="eg_pas_paleur" onchange="updateProgress()"><span>Pas de p√¢leur cutan√©o-muqueuse</span></label>
            <label class="check-item"><input type="checkbox" name="eg_pas_ictere" onchange="updateProgress()"><span>Pas d'ict√®re</span></label>
            <label class="check-item"><input type="checkbox" name="eg_pas_cyanose_generale" onchange="updateProgress()"><span>Pas de cyanose</span></label>
          </div>
        </div>
        <div class="check-list" style="margin-top:4px;">
          <label class="check-item"><input type="checkbox" name="eg_pas_deshydratation" onchange="updateProgress()"><span>Pas de signe de d√©shydratation (pli cutan√©, TRC &lt; 3s)</span></label>
          <label class="check-item"><input type="checkbox" name="eg_pas_signes_choc" onchange="updateProgress()"><span>Pas de signes de choc (marbrures, froideur extr√©mit√©s)</span></label>
          <label class="check-item"><input type="checkbox" name="eg_pas_denutrition" onchange="updateProgress()"><span>Pas de signe de d√©nutrition</span></label>
          <label class="check-item"><input type="checkbox" name="eg_pas_omi" onchange="updateProgress()"><span>Pas d'≈ìd√®me des membres inf√©rieurs (OMI)</span></label>
        </div>
        <hr class="divider">
        <div class="subsubsection-title" style="margin:10px 0 8px;">Constantes vitales</div>
        <div class="fields-row">
          <div class="field-group">
            <label class="field-label">GCS (/15)</label>
            <input type="number" name="eg_gcs" class="field-input" placeholder="15" min="3" max="15" oninput="updateProgress()">
          </div>
          <div class="field-group">
            <label class="field-label">Temp√©rature (¬∞C)</label>
            <input type="number" name="eg_temp" class="field-input" placeholder="37.0" step="0.1" oninput="updateProgress()">
          </div>
        </div>
        <div class="fields-row">
          <div class="field-group">
            <label class="field-label">TA MS droit (mmHg)</label>
            <input type="text" name="eg_ta_droit" class="field-input" placeholder="120/80" oninput="updateProgress()">
          </div>
          <div class="field-group">
            <label class="field-label">TA MS gauche (mmHg)</label>
            <input type="text" name="eg_ta_gauche" class="field-input" placeholder="120/80" oninput="updateProgress()">
          </div>
        </div>
        <div class="fields-row-3">
          <div class="field-group"><label class="field-label">FC (bpm)</label><input type="number" name="eg_fc" class="field-input" placeholder="75" oninput="updateProgress()"></div>
          <div class="field-group"><label class="field-label">FR (cpm)</label><input type="number" name="eg_fr" class="field-input" placeholder="16" oninput="updateProgress()"></div>
          <div class="field-group"><label class="field-label">SpO‚ÇÇ (%)</label><input type="number" name="eg_spo2" class="field-input" placeholder="98" oninput="updateProgress()"></div>
        </div>
        <div class="fields-row-3">
          <div class="field-group"><label class="field-label">Poids (kg)</label><input type="number" name="eg_poids" class="field-input" placeholder="70" oninput="updateProgress()"></div>
          <div class="field-group"><label class="field-label">Taille (cm)</label><input type="number" name="eg_taille" class="field-input" placeholder="170" oninput="updateProgress()"></div>
          <div class="field-group"><label class="field-label">IMC</label><input type="text" name="eg_imc" class="field-input" readonly id="imc_display"></div>
        </div>
        <div class="field-group">
          <label class="field-label">Tour de taille (cm)</label>
          <input type="number" name="eg_tour_taille" class="field-input" placeholder="Normal: <80 ‚ôÄ, <94 ‚ôÇ" oninput="updateProgress()">
        </div>
      </div>

      <!-- 5.2 Examen Ganglionnaire (moved here) -->
      <div class="subsection">
        <div class="subsection-title">5.2 ‚Äî Examen Ganglionnaire</div>
        <div class="check-list">
          <label class="check-item"><input type="checkbox" name="ep_gang_aires_libres" onchange="updateProgress()"><span>Aires ganglionnaires libres (cervicales, axillaires, inguinales)</span></label>
          <label class="check-item"><input type="checkbox" name="ep_gang_sans_anomalie" onchange="updateProgress()"><span>Examen sans anomalie aux diff√©rentes aires</span></label>
          <label class="check-item"><input type="checkbox" name="ep_gang_troisier" onchange="updateProgress()"><span>Ganglion de Troisier absent (sus-claviculaire gauche)</span></label>
        </div>
        <div class="field-group" style="margin-top:8px;">
          <label class="field-label">Ad√©nopathies d√©crites si pr√©sentes</label>
          <textarea name="ep_gang_details" class="field-input" placeholder="Site, taille, consistance, douleur, adh√©rence‚Ä¶" oninput="updateProgress()"></textarea>
        </div>
      </div>

      <!-- 5.3 Examen Abdominal -->
      <div class="subsection">
        <div class="subsection-title">5.3 ‚Äî Examen Abdominal</div>
        <div class="subsubsection">
          <div class="subsubsection-title">üëÄ Inspection</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="abd_resp_normale" onchange="updateProgress()"><span>Respiration abdominale normale</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_deformation" onchange="updateProgress()"><span>Pas de d√©formation ni distension abdominale</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_cicatrices" onchange="updateProgress()"><span>Pas de cicatrices chirurgicales</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_circulation_collaterale" onchange="updateProgress()"><span>Pas de circulation veineuse collat√©rale</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_voussures_vergetures" onchange="updateProgress()"><span>Pas de voussures, vergetures ni points de feu</span></label>
            <label class="check-item"><input type="checkbox" name="abd_ombilic_plisse" onchange="updateProgress()"><span>Ombilic bien pliss√©</span></label>
            <label class="check-item"><input type="checkbox" name="abd_teguments_normaux" onchange="updateProgress()"><span>T√©guments d'aspect normal</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_asterixis" onchange="updateProgress()"><span>Pas d'ast√©rixis</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_leuconychie_erytheme" onchange="updateProgress()"><span>Pas de leuconychie ni √©ryth√®me palmaire</span></label>
          </div>
        </div>
        <div class="subsubsection">
          <div class="subsubsection-title">üñêÔ∏è Palpation</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="abd_souple_depressible" onchange="updateProgress()"><span>Abdomen souple et d√©pressible</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_defense_contracture" onchange="updateProgress()"><span>Pas de d√©fense, contracture ni sensibilit√© localis√©e</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_organomegalie" onchange="updateProgress()"><span>Pas d'organom√©galie (SPM, HPM)</span></label>
            <label class="check-item"><input type="checkbox" name="abd_hepatomegalie" onchange="updateProgress()"><span>H√©patom√©galie pr√©sente</span></label>
          </div>
          <div class="field-group" style="margin-top:6px; margin-left:36px;">
            <label class="field-label">Fl√®che h√©patique (cm)</label>
            <input type="number" name="abd_fleche_hepatique" class="field-input" placeholder="Ex: 12" step="0.5" oninput="updateProgress()">
          </div>
          <div class="check-list" style="margin-top:4px;">
            <label class="check-item"><input type="checkbox" name="abd_splenomegalie" onchange="updateProgress()"><span>Spl√©nom√©galie pr√©sente</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_contact_lombaire" onchange="updateProgress()"><span>Pas de contact lombaire</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_masse_palpable" onchange="updateProgress()"><span>Pas de masse palpable</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_hernie" onchange="updateProgress()"><span>Orifices herniaires libres</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_signe_flot" onchange="updateProgress()"><span>Pas de signe du flot (ascite)</span></label>
          </div>
          <div class="field-group" style="margin-top:8px;">
            <label class="field-label">Zone douloureuse</label>
            <input type="text" name="abd_zone_douloureuse" class="field-input" placeholder="Ex: Fosse iliaque droite, hypochondre gauche‚Ä¶" oninput="updateProgress()">
          </div>
        </div>
        <div class="subsubsection">
          <div class="subsubsection-title">üîä Percussion</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="abd_pas_matite" onchange="updateProgress()"><span>Pas de matit√© d√©clive (pas d'ascite)</span></label>
            <label class="check-item"><input type="checkbox" name="abd_tympanisme_normal" onchange="updateProgress()"><span>Tympanisme normal sur les 9 r√©gions</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_meteorisme" onchange="updateProgress()"><span>Pas de m√©t√©orisme</span></label>
          </div>
        </div>
        <div class="subsubsection">
          <div class="subsubsection-title">ü©∫ Auscultation</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="abd_transit_audible" onchange="updateProgress()"><span>Bruits hydro-a√©riques pr√©sents (transit audible)</span></label>
            <label class="check-item"><input type="checkbox" name="abd_pas_souffle_abdominal" onchange="updateProgress()"><span>Pas de souffle aortique ni r√©nal</span></label>
          </div>
        </div>
        <div class="subsubsection">
          <div class="subsubsection-title">Toucher Rectal (TR)</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="tr_non_realise" onchange="updateProgress()"><span>Non r√©alis√©</span></label>
            <label class="check-item"><input type="checkbox" name="tr_fissures" onchange="updateProgress()"><span>Fissures √† l'inspection externe</span></label>
            <label class="check-item"><input type="checkbox" name="tr_hemorroides" onchange="updateProgress()"><span>H√©morro√Ødes</span></label>
            <label class="check-item"><input type="checkbox" name="tr_cri_douglas" onchange="updateProgress()"><span>Cri de Douglas (p√©ritonite)</span></label>
          </div>
          <div class="field-group" style="margin-top:8px;">
            <label class="field-label">TR ‚Äì Tonus / Prostate / Contenu / Doigtier</label>
            <textarea name="tr_details" class="field-input" placeholder="Pr√©cisions‚Ä¶" oninput="updateProgress()"></textarea>
          </div>
        </div>
      </div>

      <!-- 5.4 Cardiaque -->
      <div class="subsection">
        <div class="subsection-title">5.4 ‚Äî Examen Cardiaque</div>
        <div class="subsubsection">
          <div class="subsubsection-title">Signes p√©riph√©riques</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="card_pas_hippocratisme" onchange="updateProgress()"><span>Pas d'hippocratisme digital</span></label>
            <label class="check-item"><input type="checkbox" name="card_pas_xanthomes" onchange="updateProgress()"><span>Pas de xanthomes</span></label>
            <label class="check-item"><input type="checkbox" name="card_trc_normal" onchange="updateProgress()"><span>TRC normal &lt; 2 secondes</span></label>
            <label class="check-item"><input type="checkbox" name="card_pas_jvp" onchange="updateProgress()"><span>Pas d'√©l√©vation de la pression veineuse jugulaire (JVP)</span></label>
            <label class="check-item"><input type="checkbox" name="card_pas_cyanose_centrale" onchange="updateProgress()"><span>Pas de cyanose centrale</span></label>
          </div>
        </div>
        <div class="subsubsection">
          <div class="subsubsection-title">üëÄ Inspection & üñêÔ∏è Palpation</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="ep_card_insp_thorax_symetrique" onchange="updateProgress()"><span>Thorax sym√©trique, pas de d√©formation</span></label>
            <label class="check-item"><input type="checkbox" name="ep_card_insp_pas_circulation" onchange="updateProgress()"><span>Pas de circulation veineuse collat√©rale thoracique</span></label>
            <label class="check-item"><input type="checkbox" name="ep_card_insp_pas_oedeme_mi" onchange="updateProgress()"><span>Pas d'≈ìd√®me des membres inf√©rieurs</span></label>
            <label class="check-item"><input type="checkbox" name="ep_card_palp_choc_pointe" onchange="updateProgress()"><span>Choc de pointe bien per√ßu, punctiforme, non d√©plac√©</span></label>
            <label class="check-item"><input type="checkbox" name="ep_card_palp_harzer_negatif" onchange="updateProgress()"><span>Signe de Harzer n√©gatif</span></label>
            <label class="check-item"><input type="checkbox" name="ep_card_palp_pas_thrill" onchange="updateProgress()"><span>Pas de thrill (fr√©missement) sus-sternal</span></label>
            <label class="check-item"><input type="checkbox" name="ep_card_palp_pas_reflux" onchange="updateProgress()"><span>Pas de reflux h√©pato-jugulaire</span></label>
          </div>
        </div>
        <div class="subsubsection">
          <div class="subsubsection-title">ü©∫ Auscultation cardiaque</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="ep_card_ausc_bruits_coeur_percus" onchange="updateProgress()"><span>B1 et B2 bien per√ßus aux 4 foyers</span></label>
            <label class="check-item"><input type="checkbox" name="ep_card_ausc_systole_diastole_libres" onchange="updateProgress()"><span>Systole et diastole libres √† chaque foyer</span></label>
            <label class="check-item"><input type="checkbox" name="ep_card_ausc_pas_frottement" onchange="updateProgress()"><span>Pas de frottement p√©ricardique</span></label>
            <label class="check-item"><input type="checkbox" name="ep_card_ausc_pas_sons_surajoutes" onchange="updateProgress()"><span>Pas de B3, B4 ni de souffle</span></label>
            <label class="check-item"><input type="checkbox" name="ep_card_pas_insuffisance" onchange="updateProgress()"><span>Pas d'insuffisance cardiaque droite ni gauche</span></label>
          </div>
          <div class="field-group" style="margin-top:8px;">
            <label class="field-label">Rythme / Souffle (si pr√©sent)</label>
            <textarea name="ep_card_details" class="field-input" placeholder="Rythme, souffle : si√®ge, temps, timbre, irradiation, intensit√© /6‚Ä¶" oninput="updateProgress()"></textarea>
          </div>
        </div>
      </div>

      <!-- 5.5 Pulmonaire -->
      <div class="subsection">
        <div class="subsection-title">5.5 ‚Äî Examen Pleuro-Pulmonaire</div>
        <div class="check-list">
          <label class="check-item"><input type="checkbox" name="pulm_thorax_symetrique" onchange="updateProgress()"><span>Thorax sym√©trique, ampliation thoracique normale</span></label>
          <label class="check-item"><input type="checkbox" name="pulm_pas_tirage" onchange="updateProgress()"><span>Pas de tirage ni signes de lutte respiratoire</span></label>
          <label class="check-item"><input type="checkbox" name="pulm_pas_cyanose" onchange="updateProgress()"><span>Pas de cyanose</span></label>
          <label class="check-item"><input type="checkbox" name="pulm_vv_normaux" onchange="updateProgress()"><span>Vibrations vocales sym√©triques et normales</span></label>
          <label class="check-item"><input type="checkbox" name="pulm_mv_bilateral" onchange="updateProgress()"><span>Murmure v√©siculaire pr√©sent et sym√©trique bilat√©ralement</span></label>
          <label class="check-item"><input type="checkbox" name="pulm_pas_rales" onchange="updateProgress()"><span>Pas de r√¢les cr√©pitants ni sibilants</span></label>
          <label class="check-item"><input type="checkbox" name="pulm_pas_matite" onchange="updateProgress()"><span>Pas de matit√© √† la percussion (pas d'√©panchement)</span></label>
          <label class="check-item"><input type="checkbox" name="pulm_pas_frottement_pleural" onchange="updateProgress()"><span>Pas de frottement pleural</span></label>
        </div>
        <div class="field-group" style="margin-top:8px;">
          <label class="field-label">Pr√©cisions / anomalies pulmonaires</label>
          <textarea name="pulm_details" class="field-input" placeholder="Ex: cr√©pitants bases gauches, syndrome de condensation‚Ä¶" oninput="updateProgress()"></textarea>
        </div>
      </div>

      <!-- 5.6 Neurologique -->
      <div class="subsection">
        <div class="subsection-title">5.6 ‚Äî Examen Neurologique</div>
        <div class="subsubsection">
          <div class="subsubsection-title">Conscience & Orientation</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="ep_neuro_conscient" onchange="updateProgress()"><span>Conscient, alerte</span></label>
            <label class="check-item"><input type="checkbox" name="ep_neuro_oriente_tps_espace" onchange="updateProgress()"><span>Orient√© dans le temps et l'espace</span></label>
            <label class="check-item"><input type="checkbox" name="ep_neuro_pas_confusion" onchange="updateProgress()"><span>Pas de confusion ni de troubles cognitifs</span></label>
          </div>
        </div>
        <div class="subsubsection">
          <div class="subsubsection-title">Motricit√© & Coordination</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="ep_neuro_pas_deficit_moteur" onchange="updateProgress()"><span>Pas de d√©ficit moteur aux 4 membres</span></label>
            <label class="check-item"><input type="checkbox" name="ep_neuro_pas_deficit_sensitif" onchange="updateProgress()"><span>Pas de d√©ficit sensitif</span></label>
            <label class="check-item"><input type="checkbox" name="ep_neuro_pas_ataxie" onchange="updateProgress()"><span>Pas d'ataxie c√©r√©belleuse (marche, doigt-nez normaux)</span></label>
            <label class="check-item"><input type="checkbox" name="ep_neuro_babinski_negatif" onchange="updateProgress()"><span>Signe de Babinski n√©gatif</span></label>
            <label class="check-item"><input type="checkbox" name="ep_neuro_rot_present" onchange="updateProgress()"><span>ROT pr√©sents et sym√©triques aux 4 membres</span></label>
            <label class="check-item"><input type="checkbox" name="ep_neuro_pas_clonus" onchange="updateProgress()"><span>Pas de clonus</span></label>
          </div>
          <div class="field-group" style="margin-top:8px;">
            <label class="field-label">Pr√©cisions ROT / motricit√©</label>
            <input type="text" name="ep_neuro_rot_details" class="field-input" placeholder="Ex: ROT vifs MS, abolis MI" oninput="updateProgress()">
          </div>
        </div>
        <div class="subsubsection">
          <div class="subsubsection-title">Signes m√©ning√©s</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="ep_neuro_nuque_souple" onchange="updateProgress()"><span>Nuque souple (pas de raideur m√©ning√©e)</span></label>
            <label class="check-item"><input type="checkbox" name="ep_neuro_kernig" onchange="updateProgress()"><span>Signe de Kernig n√©gatif</span></label>
            <label class="check-item"><input type="checkbox" name="ep_neuro_brudzinski" onchange="updateProgress()"><span>Signe de Brudzinski n√©gatif</span></label>
          </div>
        </div>
        <div class="subsubsection">
          <div class="subsubsection-title">Examen cervical</div>
          <div class="check-list">
            <label class="check-item"><input type="checkbox" name="ep_cerv_insp_normal" onchange="updateProgress()"><span>Pas de tum√©faction, turgescence jugulaire, goitre</span></label>
            <label class="check-item"><input type="checkbox" name="ep_cerv_thyroide_normale" onchange="updateProgress()"><span>Corps thyro√Ødien de taille normale, mobile √† la d√©glutition</span></label>
            <label class="check-item"><input type="checkbox" name="ep_cerv_pas_adp" onchange="updateProgress()"><span>Pas d'ad√©nopathies cervicales</span></label>
          </div>
        </div>
      </div>

      <!-- 5.7 Ost√©o-articulaire -->
      <div class="subsection">
        <div class="subsection-title">5.7 ‚Äî Examen Ost√©o-Articulaire</div>
        <div class="fields-row">
          <div class="field-group">
            <label class="field-label">Localisation douleur</label>
            <input type="text" name="ep_oa_douleur_localisation" class="field-input" placeholder="Ex: genou droit" oninput="updateProgress()">
          </div>
          <div class="field-group">
            <label class="field-label">EVA /10</label>
            <input type="number" name="ep_oa_intensite_eva" class="field-input" placeholder="5" min="0" max="10" oninput="updateProgress()">
          </div>
        </div>
        <div class="check-list">
          <label class="check-item"><input type="checkbox" name="ep_oa_raideur_matinale" onchange="updateProgress()"><span>Raideur matinale pr√©sente</span></label>
        </div>
        <div class="field-group" style="margin-top:8px;">
          <label class="field-label">Pr√©cisions (GALS, rachis, articulations‚Ä¶)</label>
          <textarea name="ep_oa_details" class="field-input" placeholder="M√©canique / inflammatoire, amplitude, tests‚Ä¶" oninput="updateProgress()"></textarea>
        </div>
      </div>

      <!-- 5.8 Uro-g√©nital -->
      <div class="subsection">
        <div class="subsection-title">5.8 ‚Äî Examen Uro-G√©nital</div>
        <div class="check-list">
          <label class="check-item"><input type="checkbox" name="ep_ug_pas_globe_vesical" onchange="updateProgress()"><span>Pas de globe v√©sical</span></label>
          <label class="check-item"><input type="checkbox" name="ep_ug_pas_douleur_fosaillon" onchange="updateProgress()"><span>Pas de douleur √† la palpation des fosses lombaires</span></label>
          <label class="check-item"><input type="checkbox" name="ep_ug_giordano_negatif" onchange="updateProgress()"><span>Signe de Giordano n√©gatif</span></label>
        </div>
        <div class="field-group" style="margin-top:8px;">
          <label class="field-label">Pr√©cisions (prostate, OGE, TV‚Ä¶)</label>
          <textarea name="ep_ug_details" class="field-input" placeholder="Prostate, organes g√©nitaux externes, toucher vaginal‚Ä¶" oninput="updateProgress()"></textarea>
        </div>
      </div>

      <!-- 5.9 Cutan√© & Buccal -->
      <div class="subsection">
        <div class="subsection-title">5.9 ‚Äî Examen Cutan√© &amp; Cavit√© Buccale</div>
        <div class="check-list">
          <label class="check-item"><input type="checkbox" name="ep_cut_normal" onchange="updateProgress()"><span>T√©guments sans l√©sion cutan√©e particuli√®re</span></label>
          <label class="check-item"><input type="checkbox" name="ep_cut_pas_paleur" onchange="updateProgress()"><span>Pas de p√¢leur cutan√©e</span></label>
          <label class="check-item"><input type="checkbox" name="ep_cut_pas_ictere" onchange="updateProgress()"><span>Pas d'ict√®re</span></label>
          <label class="check-item"><input type="checkbox" name="ep_cut_pas_cyanose2" onchange="updateProgress()"><span>Pas de cyanose</span></label>
        </div>
        <div class="field-group" style="margin-top:8px;">
          <label class="field-label">L√©sions cutan√©es d√©crites (si pr√©sentes)</label>
          <textarea name="ep_cut_lesions" class="field-input" placeholder="Macule, papule, v√©sicule, bulle, pustule, plaque‚Ä¶" oninput="updateProgress()"></textarea>
        </div>
        <div class="check-list" style="margin-top:6px;">
          <label class="check-item"><input type="checkbox" name="ep_cb_normal" onchange="updateProgress()"><span>Cavit√© buccale sans anomalie (langue, l√®vres, gencives normaux)</span></label>
        </div>
        <div class="field-group" style="margin-top:8px;">
          <label class="field-label">Anomalies buccales</label>
          <input type="text" name="ep_cb_anomalies" class="field-input" placeholder="Haleine c√©tonique, aphtes, angine, macroglossie‚Ä¶" oninput="updateProgress()">
        </div>
      </div>

      <!-- Zone libre -->
      <div class="subsection">
        <div class="subsection-title">Zone Libre ‚Äî Autres examens sp√©cialis√©s</div>
        <div class="field-group">
          <textarea name="exam_autres" class="field-input" rows="3" placeholder="Fond d'≈ìil, examen gyn√©cologique, examen du sein, dermatologique, ORL‚Ä¶" oninput="updateProgress()"></textarea>
        </div>
      </div>

    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê 6. CONCLUSION & HYPOTH√àSES DIAGNOSTIQUES ‚ïê‚ïê‚ïê -->
  <div class="section-card">
    <div class="section-header" onclick="toggleSection(this)">
      <div class="section-num">6</div>
      <div class="section-title">Conclusion Clinique &amp; Hypoth√®ses Diagnostiques<div class="section-subtitle">R√©sum√© ¬∑ Table diagnostique</div></div>
      <span class="section-badge" id="badge-6">‚Äî</span>
      <span class="toggle-icon">+</span>
    </div>
    <div class="section-body">

      <!-- R√©sum√© clinique -->
      <div class="field-group">
        <label class="field-label">R√©sum√© clinique</label>
        <textarea name="cc_resume_clinique" class="field-input" placeholder="Au total, il s'agit de M./Mme ‚Ä¶, √¢g√©(e) de ‚Ä¶, qui consulte pour‚Ä¶" oninput="updateProgress()" rows="4"></textarea>
      </div>
      <div class="field-group">
        <label class="field-label">et chez qui l'examen clinique objective</label>
        <textarea name="cc_signes_physiques" class="field-input" placeholder="Signes positifs trouv√©s √† l'examen physique‚Ä¶" oninput="updateProgress()"></textarea>
      </div>
      <div class="field-group">
        <label class="field-label">Signes fonctionnels r√©sum√©s</label>
        <textarea name="cc_signes_fonctionnels" class="field-input" placeholder="Sympt√¥mes rapport√©s par le patient‚Ä¶ ; sans autres signes associ√©s." oninput="updateProgress()"></textarea>
      </div>

      <hr class="divider">

      <!-- Hypoth√®ses diagnostiques table -->
      <div style="margin-bottom:8px;">
        <div class="subsection-title" style="margin-top:0;">Hypoth√®ses Diagnostiques</div>
      </div>
      <div class="diag-table-wrap">
        <table class="diag-table" id="diagTable">
          <thead>
            <tr>
              <th style="width:28px;">#</th>
              <th>Hypoth√®se Diagnostique</th>
              <th>Arguments Pour</th>
              <th>Arguments Contre</th>
              <th style="width:34px;"></th>
            </tr>
          </thead>
          <tbody id="diagTableBody">
            <!-- rows added by JS -->
          </tbody>
        </table>
      </div>
      <button class="add-row-btn" onclick="addDiagRow()">+ Ajouter une hypoth√®se</button>

    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê 7. CAT ‚ïê‚ïê‚ïê -->
  <div class="section-card">
    <div class="section-header" onclick="toggleSection(this)">
      <div class="section-num">7</div>
      <div class="section-title">CAT ‚Äî Conduite √Ä Tenir<div class="section-subtitle">Diagnostique et th√©rapeutique</div></div>
      <span class="section-badge" id="badge-7">‚Äî</span>
      <span class="toggle-icon">+</span>
    </div>
    <div class="section-body">
      <div class="subsection">
        <div class="subsection-title">7.1 ‚Äî Diagnostique</div>
        <div class="check-list">
          <label class="check-item"><input type="checkbox" name="cat_biologie" onchange="updateProgress()"><span>Bilan biologique (NFS, bilan h√©patique, r√©nal, ionogramme‚Ä¶)</span></label>
          <label class="check-item"><input type="checkbox" name="cat_imagerie" onchange="updateProgress()"><span>Imagerie (RX, Echo, TDM, IRM‚Ä¶)</span></label>
          <label class="check-item"><input type="checkbox" name="cat_autres_examens" onchange="updateProgress()"><span>Autres examens (ECG, endoscopie, biopsie, √©lectrophysiologie‚Ä¶)</span></label>
        </div>
        <div class="field-group" style="margin-top:10px;">
          <label class="field-label">Plan d'examens compl√©mentaires hi√©rarchis√©s</label>
          <textarea name="cat_examens_details" class="field-input" placeholder="En urgence: 1.&#10;En diff√©r√©: 2." oninput="updateProgress()"></textarea>
        </div>
      </div>
      <div class="subsection">
        <div class="subsection-title">7.2 ‚Äî Th√©rapeutique</div>
        <div class="check-list">
          <label class="check-item"><input type="checkbox" name="cat_ther_etiologique" onchange="updateProgress()"><span>Traitement √©tiologique (traiter la cause)</span></label>
          <label class="check-item"><input type="checkbox" name="cat_ther_symptomatique" onchange="updateProgress()"><span>Traitement symptomatique (soulager les sympt√¥mes)</span></label>
          <label class="check-item"><input type="checkbox" name="cat_ther_mesures_hygiene" onchange="updateProgress()"><span>Mesures hygi√©no-di√©t√©tiques</span></label>
          <label class="check-item"><input type="checkbox" name="cat_ther_surveillance" onchange="updateProgress()"><span>Plan de surveillance et de suivi d√©fini</span></label>
          <label class="check-item"><input type="checkbox" name="cat_ther_education" onchange="updateProgress()"><span>√âducation th√©rapeutique du patient planifi√©e</span></label>
        </div>
        <div class="field-group" style="margin-top:10px;">
          <label class="field-label">D√©tails du traitement</label>
          <textarea name="cat_traitement_details" class="field-input" placeholder="M√©dicaments, doses, dur√©e, ordonnance‚Ä¶" oninput="updateProgress()"></textarea>
        </div>
      </div>
    </div>
  </div>

</div><!-- /container -->

<div class="sticky-bar">
  <button class="btn btn-danger" onclick="resetAll()">üóë R√©init.</button>
  <button class="btn btn-primary" onclick="generateDocx()" id="docxBtn">üìÑ Word</button>
  <button class="btn btn-success" onclick="generateGoogleDocs()">üìë Google Docs</button>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ Toggle sections ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleSection(h) {
  const b = h.nextElementSibling, icon = h.querySelector('.toggle-icon');
  const open = b.classList.contains('open');
  b.classList.toggle('open', !open);
  icon.textContent = open ? '+' : '‚àí';
  icon.classList.toggle('open', !open);
}
function expandAll()  { document.querySelectorAll('.section-body').forEach(b => { b.classList.add('open'); const i = b.previousElementSibling.querySelector('.toggle-icon'); if(i){i.textContent='‚àí';i.classList.add('open');} }); }
function collapseAll(){ document.querySelectorAll('.section-body').forEach(b => { b.classList.remove('open'); const i = b.previousElementSibling.querySelector('.toggle-icon'); if(i){i.textContent='+';i.classList.remove('open');} }); }

// ‚îÄ‚îÄ‚îÄ Age / DOB auto-calc ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let ageUpdating = false;
function calcAgeFromDOB() {
  if (ageUpdating) return;
  const dob = document.querySelector('[name="date_naissance"]').value;
  if (!dob) return;
  const today = new Date(), birth = new Date(dob);
  let age = today.getFullYear() - birth.getFullYear();
  const m = today.getMonth() - birth.getMonth();
  if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) age--;
  ageUpdating = true;
  document.getElementById('age_field').value = age + ' ans';
  ageUpdating = false;
}
function calcDOBFromAge() {
  if (ageUpdating) return;
  const ageVal = document.getElementById('age_field').value.replace(/\D/g,'').trim();
  if (!ageVal) return;
  const yearEst = new Date().getFullYear() - parseInt(ageVal);
  const dobEl = document.querySelector('[name="date_naissance"]');
  if (!dobEl.value) {
    ageUpdating = true;
    dobEl.value = `${yearEst}-01-01`;
    ageUpdating = false;
  }
}

// ‚îÄ‚îÄ‚îÄ ECOG preview ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showEcog() {
  const val = document.querySelector('[name="ecog_score"]').value;
  const el = document.getElementById('ecog_preview');
  if (!val) { el.innerHTML = ''; return; }
  const labels = { '0':'PS 0 ‚Äî Activit√© normale','1':'PS 1 ‚Äî Ambulatoire, activit√© intenses restreintes','2':'PS 2 ‚Äî Ambulatoire, incapable de travailler','3':'PS 3 ‚Äî Alit√© >50% du temps, soin limit√©','4':'PS 4 ‚Äî Invalide total, alit√© 100%' };
  el.innerHTML = `<span class="ecog-preview ecog-${val}">${labels[val]}</span>`;
}

// ‚îÄ‚îÄ‚îÄ Diagnostic table ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let diagRowCount = 0;
function addDiagRow() {
  diagRowCount++;
  const tbody = document.getElementById('diagTableBody');
  const tr = document.createElement('tr');
  tr.id = 'diagRow_' + diagRowCount;
  tr.innerHTML = `
    <td class="row-num">${diagRowCount}</td>
    <td><textarea name="diag_hyp_${diagRowCount}" placeholder="Hypoth√®se ${diagRowCount}‚Ä¶" oninput="updateProgress()"></textarea></td>
    <td><textarea name="diag_pour_${diagRowCount}" placeholder="- Terrain&#10;- Ant√©c√©dents&#10;- Signes fonctionnels&#10;- Signes physiques" oninput="updateProgress()"></textarea></td>
    <td><textarea name="diag_contre_${diagRowCount}" placeholder="- Terrain&#10;- Ant√©c√©dents&#10;- Signes fonctionnels&#10;- Signes physiques" oninput="updateProgress()"></textarea></td>
    <td class="del-cell"><button class="del-btn" onclick="removeDiagRow('diagRow_${diagRowCount}')" title="Supprimer">‚úï</button></td>`;
  tbody.appendChild(tr);
  updateProgress();
}
function removeDiagRow(id) {
  const row = document.getElementById(id);
  if (row) { row.remove(); renumberDiagRows(); updateProgress(); }
}
function renumberDiagRows() {
  document.querySelectorAll('#diagTableBody tr').forEach((tr, i) => {
    const num = tr.querySelector('.row-num');
    if (num) num.textContent = i + 1;
  });
}
// Init 3 rows
addDiagRow(); addDiagRow(); addDiagRow();

// ‚îÄ‚îÄ‚îÄ IMC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calcIMC() {
  const p = parseFloat(document.querySelector('[name="eg_poids"]')?.value);
  const t = parseFloat(document.querySelector('[name="eg_taille"]')?.value);
  const el = document.getElementById('imc_display');
  if (p && t) {
    const imc = (p/((t/100)**2)).toFixed(1);
    const cat = imc<18.5?'Maigreur':imc<25?'Normal':imc<30?'Surpoids':'Ob√©sit√©';
    el.value = `${imc} (${cat})`;
    document.querySelector('[name="eg_imc"]').value = el.value;
  } else el.value = '';
}
document.querySelector('[name="eg_poids"]')?.addEventListener('input', calcIMC);
document.querySelector('[name="eg_taille"]')?.addEventListener('input', calcIMC);

// ‚îÄ‚îÄ‚îÄ Progress ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateProgress() {
  let filled = 0, total = 0;
  document.querySelectorAll('input[type="text"],input[type="number"],input[type="date"],input[type="time"],input[type="tel"],textarea,select').forEach(el => {
    if (el.readOnly) return;
    total++;
    if (el.value && el.value.trim()) filled++;
  });
  document.querySelectorAll('input[type="checkbox"]').forEach(el => { total++; if(el.checked) filled++; });
  const pct = total ? Math.min(100, Math.round((filled/total)*100)) : 0;
  document.getElementById('progressBar').style.width = pct+'%';
  [1,2,3,4,5,6,7].forEach(n => updateBadge(n));
}
function updateBadge(n) {
  const badge = document.getElementById('badge-'+n);
  if (!badge) return;
  const card = badge.closest('.section-card');
  if (!card) return;
  const body = card.querySelector('.section-body');
  const checked = body.querySelectorAll('input[type="checkbox"]:checked').length;
  const totalCb = body.querySelectorAll('input[type="checkbox"]').length;
  const filled = Array.from(body.querySelectorAll('input[type="text"],input[type="number"],input[type="date"],input[type="time"],input[type="tel"],textarea,select')).filter(el=>el.value&&el.value.trim()&&!el.readOnly).length;
  if(filled>0||checked>0){badge.textContent=`‚úì ${checked}/${totalCb} ¬∑ ${filled} champs`;badge.classList.add('done');}
  else{badge.textContent='‚Äî';badge.classList.remove('done');}
}

// ‚îÄ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(m) { const t=document.getElementById('toast'); t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2800); }

// ‚îÄ‚îÄ‚îÄ Reset ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function resetAll() {
  if(!confirm('Voulez-vous vraiment effacer toute l\'observation ?')) return;
  document.querySelectorAll('input[type="text"],input[type="number"],input[type="date"],input[type="time"],input[type="tel"],textarea').forEach(el=>el.value='');
  document.querySelectorAll('select').forEach(el=>el.selectedIndex=0);
  document.querySelectorAll('input[type="checkbox"]').forEach(el=>el.checked=false);
  document.getElementById('imc_display').value='';
  document.getElementById('ecog_preview').innerHTML='';
  // Reset diag table
  document.getElementById('diagTableBody').innerHTML='';
  diagRowCount=0;
  addDiagRow(); addDiagRow(); addDiagRow();
  updateProgress();
  showToast('‚úÖ Observation r√©initialis√©e');
}

// ‚îÄ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function v(name) { const el=document.querySelector(`[name="${name}"]`); return el?el.value.trim():''; }
function isChecked(name) { const el=document.querySelector(`input[name="${name}"]`); return el?el.checked:false; }
function checkedLabel(name) { const el=document.querySelector(`input[name="${name}"]`); if(!el||!el.checked) return ''; const lbl=el.closest('label'); return lbl?lbl.querySelector('span').textContent.trim():name; }

// ‚îÄ‚îÄ‚îÄ Get diagnostic table rows ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getDiagRows() {
  const rows = [];
  document.querySelectorAll('#diagTableBody tr').forEach(tr => {
    const tas = tr.querySelectorAll('textarea');
    if(tas.length>=3) {
      const hyp=tas[0].value.trim(), pour=tas[1].value.trim(), contre=tas[2].value.trim();
      if(hyp||pour||contre) rows.push({hyp,pour,contre});
    }
  });
  return rows;
}

// ‚îÄ‚îÄ‚îÄ Build text ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildObservationText() {
  const lines = [];
  const date = new Date().toLocaleDateString('fr-FR',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
  function h1(t){lines.push('','‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê',t.toUpperCase(),'‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');}
  function h2(t){lines.push('','--- '+t+' ---');}
  function field(lbl,val){if(val)lines.push(`  ${lbl} : ${val}`);}
  function chk(name,fb){if(isChecked(name))lines.push(`  ‚úî ${fb||checkedLabel(name)}`);}

  lines.push('OBSERVATION M√âDICALE');
  lines.push(`G√©n√©r√©e le : ${date}`);
  if(v('clinicien_nom')) lines.push(`Clinicien : ${v('clinicien_nom')}${v('clinicien_fonction')?' ('+v('clinicien_fonction')+')':''}`);
  if(v('obs_date')) lines.push(`Date : ${v('obs_date')}${v('obs_heure')?' √† '+v('obs_heure'):''}`);

  h1('I. Identit√© du Patient');
  field('Nom et Pr√©nom',v('nom_prenom')); field('Date de naissance',v('date_naissance')); field('√Çge',v('age'));
  field('Sexe',v('sexe')); field('Situation familiale',v('situation_familiale'));field('Nb enfants',v('nb_enfants'));
  field('Originaire de',v('originaire_de')); field('R√©sidant √†',v('residant_a')); field('Profession',v('profession'));
  field('Couverture sociale',v('couverture_sociale'));
  if(v('contact_type')) field('Contact ('+v('contact_type')+')',v('contact_numero'));
  if(v('confiance_nom')) lines.push(`  Personne de confiance : ${v('confiance_nom')} ‚Äî ${v('confiance_contact')}`);
  field('Autonomie',v('autonomie'));
  if(v('ecog_score')) field('PS OMS / ECOG','PS '+v('ecog_score'));

  h1('II. Motif de Consultation');
  field('Plainte principale',v('plainte_principale')); field('D√©but',v('date_debut_symptomes'));

  h1('III. Ant√©c√©dents (ATCD)');
  h2('A. Personnels ‚Äî 1. M√©dicaux');
  ['atcd_diabete','atcd_hta','atcd_asthme','atcd_ulcere','atcd_tuberculose','atcd_mst','atcd_hospitalisations'].forEach(n=>chk(n));
  field('Pr√©cisions',v('atcd_medicaux_details'));
  h2('A. Personnels ‚Äî 2. Chirurgicaux');
  field('Type',v('atcd_chir_type'));field('Date',v('atcd_chir_date'));field('Lieu',v('atcd_chir_lieu'));field('Complications',v('atcd_chir_complications'));
  h2('A. Personnels ‚Äî 3. Toxico-Allergiques');
  field('Tabagisme',v('atcd_tabagisme_statut')+(v('atcd_tabagisme_pa')?' ‚Äî '+v('atcd_tabagisme_pa'):''));
  field('Alcool / Drogues',v('atcd_alcool_drogues'));field('Allergies',v('atcd_allergies'));chk('atcd_contact_animaux');
  h2('A. Personnels ‚Äî 4. Traitements en cours');
  field('M√©dicaments',v('atcd_traitements'));chk('atcd_verif_ordonnances','Ordonnances v√©rifi√©es');
  h2('A. Personnels ‚Äî 5. Vaccination');
  field('Statut vaccinal',v('atcd_vaccination'));
  h2('A. Personnels ‚Äî 6. Gyn√©co-Obst√©triques');
  field('DDR',v('atcd_ddr'));field('G/P',v('atcd_gestite_parite'));field('Cycles',v('atcd_cycles'));field('Contraception',v('atcd_contraception'));field('Complications',v('atcd_gyn_complications'));
  h2('B. Familiaux (premier degr√©)');
  ['atcd_fam_diabete','atcd_fam_hta','atcd_fam_cancer','atcd_fam_cardio','atcd_fam_contage_tb'].forEach(n=>chk(n));
  field('Autres',v('atcd_fam_autres'));

  h1('IV. Histoire de la Maladie');
  field('Chronologie',v('hdM_chronologie'));field("Mode d'installation",v('hdM_mode_installation'));
  h2('SITI FADMA');
  field('Si√®ge',v('hdM_siege'));field('Irradiation',v('hdM_irradiation'));field('Type',v('hdM_type'));
  field('Impact/EVA',(v('hdM_impact')||'')+(v('hdM_eva')?' ‚Äî EVA '+v('hdM_eva')+'/10':''));
  field('Facteurs',v('hdM_facteurs_aggravants'));field('Accalmie',v('hdM_accalmie'));
  field('Dur√©e/Rythme',v('hdM_duree_rythme'));field('Mode √©volutif',v('hdM_mode_evolutif'));field('√âvolution',v('hdM_evolution_traitement'));
  h2('Signes g√©n√©raux');
  ['hdM_asthenie','hdM_anorexie','hdM_fievre','hdM_frissons','hdM_sueurs_nocturnes'].forEach(n=>chk(n));
  field('Amaigrissement',v('hdM_amaigrissement'));field('Signes associ√©s',v('hdM_signes_associes'));field('Signes n√©gatifs',v('hdM_signes_negatifs'));

  h1('V. Examen Clinique');
  h2('5.1 ‚Äî Examen G√©n√©ral/Vital & Constantes');
  ['eg_conscient_oriente','eg_stable_hemo_respi'].forEach(n=>chk(n));
  ['eg_pas_paleur','eg_pas_ictere','eg_pas_cyanose_generale'].forEach(n=>chk(n));
  ['eg_pas_deshydratation','eg_pas_signes_choc','eg_pas_denutrition','eg_pas_omi'].forEach(n=>chk(n));
  field('GCS',v('eg_gcs')?v('eg_gcs')+'/15':'');field('Temp√©rature',v('eg_temp')?v('eg_temp')+' ¬∞C':'');
  field('TA MS droit',v('eg_ta_droit')?v('eg_ta_droit')+' mmHg':'');field('TA MS gauche',v('eg_ta_gauche')?v('eg_ta_gauche')+' mmHg':'');
  field('FC',v('eg_fc')?v('eg_fc')+' bpm':'');field('FR',v('eg_fr')?v('eg_fr')+' cpm':'');field('SpO‚ÇÇ',v('eg_spo2')?v('eg_spo2')+' %':'');
  field('Poids',v('eg_poids')?v('eg_poids')+' kg':'');field('Taille',v('eg_taille')?v('eg_taille')+' cm':'');field('IMC',v('eg_imc'));
  field('Tour de taille',v('eg_tour_taille')?v('eg_tour_taille')+' cm':'');
  h2('5.2 ‚Äî Examen Ganglionnaire');
  ['ep_gang_aires_libres','ep_gang_sans_anomalie','ep_gang_troisier'].forEach(n=>chk(n));field('Ad√©nopathies',v('ep_gang_details'));
  h2('5.3 ‚Äî Examen Abdominal');
  ['abd_resp_normale','abd_pas_deformation','abd_pas_cicatrices','abd_pas_circulation_collaterale','abd_pas_voussures_vergetures','abd_ombilic_plisse','abd_teguments_normaux','abd_pas_asterixis','abd_pas_leuconychie_erytheme'].forEach(n=>chk(n));
  ['abd_souple_depressible','abd_pas_defense_contracture','abd_pas_organomegalie','abd_hepatomegalie','abd_splenomegalie','abd_pas_contact_lombaire','abd_pas_masse_palpable','abd_pas_hernie','abd_pas_signe_flot'].forEach(n=>chk(n));
  field('Zone douloureuse',v('abd_zone_douloureuse'));field('Fl√®che h√©patique',v('abd_fleche_hepatique')?v('abd_fleche_hepatique')+' cm':'');
  ['abd_pas_matite','abd_tympanisme_normal','abd_pas_meteorisme','abd_transit_audible','abd_pas_souffle_abdominal'].forEach(n=>chk(n));
  ['tr_non_realise','tr_fissures','tr_hemorroides','tr_cri_douglas'].forEach(n=>chk(n));field('TR',v('tr_details'));
  h2('5.4 ‚Äî Examen Cardiaque');
  ['card_pas_hippocratisme','card_pas_xanthomes','card_trc_normal','card_pas_jvp','card_pas_cyanose_centrale','ep_card_insp_thorax_symetrique','ep_card_insp_pas_circulation','ep_card_insp_pas_oedeme_mi','ep_card_palp_choc_pointe','ep_card_palp_harzer_negatif','ep_card_palp_pas_thrill','ep_card_palp_pas_reflux','ep_card_ausc_bruits_coeur_percus','ep_card_ausc_systole_diastole_libres','ep_card_ausc_pas_frottement','ep_card_ausc_pas_sons_surajoutes','ep_card_pas_insuffisance'].forEach(n=>chk(n));
  field('Rythme / Souffle',v('ep_card_details'));
  h2('5.5 ‚Äî Examen Pulmonaire');
  ['pulm_thorax_symetrique','pulm_pas_tirage','pulm_pas_cyanose','pulm_vv_normaux','pulm_mv_bilateral','pulm_pas_rales','pulm_pas_matite','pulm_pas_frottement_pleural'].forEach(n=>chk(n));
  field('Pr√©cisions',v('pulm_details'));
  h2('5.6 ‚Äî Examen Neurologique');
  ['ep_neuro_conscient','ep_neuro_oriente_tps_espace','ep_neuro_pas_confusion','ep_neuro_pas_deficit_moteur','ep_neuro_pas_deficit_sensitif','ep_neuro_pas_ataxie','ep_neuro_babinski_negatif','ep_neuro_rot_present','ep_neuro_pas_clonus'].forEach(n=>chk(n));
  field('ROT',v('ep_neuro_rot_details'));
  ['ep_neuro_nuque_souple','ep_neuro_kernig','ep_neuro_brudzinski','ep_cerv_insp_normal','ep_cerv_thyroide_normale','ep_cerv_pas_adp'].forEach(n=>chk(n));
  h2('5.7 ‚Äî Examen Ost√©o-Articulaire');
  field('Localisation',v('ep_oa_douleur_localisation'));field('EVA',v('ep_oa_intensite_eva')?v('ep_oa_intensite_eva')+'/10':'');chk('ep_oa_raideur_matinale');field('Pr√©cisions',v('ep_oa_details'));
  h2('5.8 ‚Äî Examen Uro-G√©nital');
  ['ep_ug_pas_globe_vesical','ep_ug_pas_douleur_fosaillon','ep_ug_giordano_negatif'].forEach(n=>chk(n));field('Pr√©cisions',v('ep_ug_details'));
  h2('5.9 ‚Äî Cutan√© & Buccal');
  ['ep_cut_normal','ep_cut_pas_paleur','ep_cut_pas_ictere','ep_cut_pas_cyanose2'].forEach(n=>chk(n));
  field('L√©sions cutan√©es',v('ep_cut_lesions'));chk('ep_cb_normal');field('Anomalies buccales',v('ep_cb_anomalies'));field('Autres',v('exam_autres'));

  h1('VI. Conclusion Clinique & Hypoth√®ses Diagnostiques');
  field('R√©sum√© clinique',v('cc_resume_clinique'));
  field('et chez qui l\'examen clinique objective',v('cc_signes_physiques'));
  field('Signes fonctionnels',v('cc_signes_fonctionnels'));
  lines.push('','Hypoth√®ses diagnostiques :');
  const diagRows = getDiagRows();
  if(diagRows.length===0) lines.push('  (aucune hypoth√®se saisie)');
  diagRows.forEach((r,i)=>{
    lines.push(`  Hypoth√®se ${i+1} : ${r.hyp}`);
    if(r.pour) lines.push(`    Arguments pour : ${r.pour}`);
    if(r.contre) lines.push(`    Arguments contre : ${r.contre}`);
  });

  h1('VII. CAT ‚Äî Conduite √Ä Tenir');
  h2('Diagnostique');
  ['cat_biologie','cat_imagerie','cat_autres_examens'].forEach(n=>chk(n));field('Examens',v('cat_examens_details'));
  h2('Th√©rapeutique');
  ['cat_ther_etiologique','cat_ther_symptomatique','cat_ther_mesures_hygiene','cat_ther_surveillance','cat_ther_education'].forEach(n=>chk(n));
  field('Traitement',v('cat_traitement_details'));
  lines.push('','‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');
  lines.push(`Sign√© : ${v('clinicien_nom')||'‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶'} ‚Äî ${v('clinicien_fonction')||'‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶'}`);

  return lines.join('\n');
}

// ‚îÄ‚îÄ‚îÄ Generate DOCX ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function generateDocx() {
  const btn = document.getElementById('docxBtn');
  btn.disabled = true; btn.textContent = '‚è≥ ...';
  try {
    const { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType, BorderStyle, Table, TableRow, TableCell, WidthType } = docx;
    const children = [];
    const date = new Date().toLocaleDateString('fr-FR',{weekday:'long',year:'numeric',month:'long',day:'numeric'});

    function h1(text) {
      return new Paragraph({ children:[new TextRun({text,bold:true,size:28,color:'FFFFFF',font:'Arial'})], heading:HeadingLevel.HEADING_1, spacing:{before:400,after:120}, shading:{fill:'1a5fa8'}, indent:{left:200} });
    }
    function h2(text) {
      return new Paragraph({ children:[new TextRun({text,bold:true,size:22,color:'0d3d72'})], spacing:{before:240,after:80}, border:{bottom:{style:BorderStyle.SINGLE,size:4,color:'b0c8e8'}} });
    }
    function row(label,val) {
      if(!val||!val.trim()) return null;
      return new Paragraph({ children:[new TextRun({text:label+' : ',bold:true,size:20}),new TextRun({text:val,size:20})], spacing:{after:60}, indent:{left:360} });
    }
    function checkRow(label) {
      return new Paragraph({ children:[new TextRun({text:'‚úî  ',color:'0a7c3e',bold:true,size:20}),new TextRun({text:label,size:20})], spacing:{after:40}, indent:{left:360} });
    }
    function addRow(lbl,name){const p=row(lbl,v(name));if(p)children.push(p);}
    function addCheck(name){if(isChecked(name))children.push(checkRow(checkedLabel(name)));}
    function addChecks(names){names.forEach(addCheck);}
    function addH1(t){children.push(h1(t));}
    function addH2(t){children.push(h2(t));}

    // Title
    children.push(new Paragraph({alignment:AlignmentType.CENTER,spacing:{after:100},children:[new TextRun({text:'OBSERVATION M√âDICALE',bold:true,size:40,color:'0d3d72',font:'Arial'})]}));
    children.push(new Paragraph({alignment:AlignmentType.CENTER,spacing:{after:200},children:[new TextRun({text:`G√©n√©r√©e le : ${date}`,italics:true,color:'666666',size:20})]}));
    if(v('clinicien_nom')) children.push(new Paragraph({alignment:AlignmentType.RIGHT,spacing:{after:400},children:[new TextRun({text:`${v('clinicien_nom')} ‚Äî ${v('clinicien_fonction')||''}`,bold:true,size:20})]}));

    // I
    addH1('I. Identit√© du Patient');
    addRow('Nom et Pr√©nom','nom_prenom'); addRow('Date de naissance','date_naissance'); addRow('√Çge','age');
    addRow('Sexe','sexe'); addRow('Situation familiale','situation_familiale'); addRow("Nombre d'enfants",'nb_enfants');
    addRow('Originaire de','originaire_de'); addRow('R√©sidant √†','residant_a'); addRow('Profession','profession');
    addRow('Couverture sociale','couverture_sociale');
    if(v('contact_numero'))children.push(row('Contact ('+v('contact_type')+')',v('contact_numero')));
    if(v('confiance_nom'))children.push(row('Personne de confiance',v('confiance_nom')+' ‚Äî '+v('confiance_contact')));
    addRow('Autonomie','autonomie');
    if(v('ecog_score'))children.push(row('PS OMS / ECOG','PS '+v('ecog_score')));

    // II
    addH1('II. Motif de Consultation');
    addRow('Plainte principale','plainte_principale'); addRow('D√©but','date_debut_symptomes');

    // III
    addH1('III. Ant√©c√©dents (ATCD)');
    addH2('A. Personnels ‚Äî 1. M√©dicaux');
    addChecks(['atcd_diabete','atcd_hta','atcd_asthme','atcd_ulcere','atcd_tuberculose','atcd_mst','atcd_hospitalisations']);
    addRow('Pr√©cisions','atcd_medicaux_details');
    addH2('A. Personnels ‚Äî 2. Chirurgicaux');
    addRow('Type','atcd_chir_type');addRow('Date','atcd_chir_date');addRow('Lieu','atcd_chir_lieu');addRow('Complications','atcd_chir_complications');
    addH2('A. Personnels ‚Äî 3. Toxico-Allergiques');
    const tabac=(v('atcd_tabagisme_statut')+(v('atcd_tabagisme_pa')?' ‚Äî '+v('atcd_tabagisme_pa'):'')).trim();
    if(tabac)children.push(row('Tabagisme',tabac));
    addRow('Alcool / Drogues','atcd_alcool_drogues');addRow('Allergies','atcd_allergies');
    if(isChecked('atcd_contact_animaux'))children.push(checkRow('Contact avec animaux'));
    addH2('A. Personnels ‚Äî 4. Traitements en cours');
    addRow('M√©dicaments','atcd_traitements');if(isChecked('atcd_verif_ordonnances'))children.push(checkRow('Ordonnances v√©rifi√©es'));
    addH2('A. Personnels ‚Äî 5. Vaccination');addRow('Statut vaccinal','atcd_vaccination');
    addH2('A. Personnels ‚Äî 6. Gyn√©co-Obst√©triques');
    addRow('DDR','atcd_ddr');addRow('G/P','atcd_gestite_parite');addRow('Cycles','atcd_cycles');addRow('Contraception','atcd_contraception');addRow('Complications','atcd_gyn_complications');
    addH2('B. Familiaux (premier degr√©)');
    addChecks(['atcd_fam_diabete','atcd_fam_hta','atcd_fam_cancer','atcd_fam_cardio','atcd_fam_contage_tb']);
    addRow('Autres','atcd_fam_autres');

    // IV
    addH1('IV. Histoire de la Maladie');
    addRow('Chronologie','hdM_chronologie');addRow("Mode d'installation",'hdM_mode_installation');
    addH2('Caract√©risation SITI FADMA');
    addRow('Si√®ge','hdM_siege');addRow('Irradiation','hdM_irradiation');addRow('Type','hdM_type');
    const imp=(v('hdM_impact')+(v('hdM_eva')?' ‚Äî EVA '+v('hdM_eva')+'/10':'')).trim();if(imp)children.push(row('Impact/Intensit√©',imp));
    addRow('Facteurs','hdM_facteurs_aggravants');addRow('Accalmie','hdM_accalmie');addRow('Dur√©e/Rythme','hdM_duree_rythme');addRow('Mode √©volutif','hdM_mode_evolutif');addRow('√âvolution','hdM_evolution_traitement');
    addH2('Signes g√©n√©raux');
    addChecks(['hdM_asthenie','hdM_anorexie','hdM_fievre','hdM_frissons','hdM_sueurs_nocturnes']);
    addRow('Amaigrissement','hdM_amaigrissement');addRow('Signes associ√©s','hdM_signes_associes');addRow('Signes n√©gatifs','hdM_signes_negatifs');

    // V
    addH1('V. Examen Clinique');
    addH2('5.1 ‚Äî Examen G√©n√©ral/Vital & Constantes');
    addChecks(['eg_conscient_oriente','eg_stable_hemo_respi','eg_pas_paleur','eg_pas_ictere','eg_pas_cyanose_generale','eg_pas_deshydratation','eg_pas_signes_choc','eg_pas_denutrition','eg_pas_omi']);
    ['eg_gcs','eg_temp','eg_ta_droit','eg_ta_gauche','eg_fc','eg_fr','eg_spo2','eg_poids','eg_taille','eg_imc','eg_tour_taille'].forEach(name=>{
      const labels={'eg_gcs':'GCS','eg_temp':'Temp√©rature','eg_ta_droit':'TA MS droit','eg_ta_gauche':'TA MS gauche','eg_fc':'FC','eg_fr':'FR','eg_spo2':'SpO‚ÇÇ','eg_poids':'Poids','eg_taille':'Taille','eg_imc':'IMC','eg_tour_taille':'Tour de taille'};
      const units={'eg_gcs':'/15','eg_temp':' ¬∞C','eg_ta_droit':' mmHg','eg_ta_gauche':' mmHg','eg_fc':' bpm','eg_fr':' cpm','eg_spo2':' %','eg_poids':' kg','eg_taille':' cm','eg_imc':'','eg_tour_taille':' cm'};
      const val=v(name);if(val)children.push(row(labels[name],val+(units[name]||'')));
    });
    addH2('5.2 ‚Äî Examen Ganglionnaire');
    addChecks(['ep_gang_aires_libres','ep_gang_sans_anomalie','ep_gang_troisier']);addRow('Ad√©nopathies','ep_gang_details');
    addH2('5.3 ‚Äî Examen Abdominal');
    addChecks(['abd_resp_normale','abd_pas_deformation','abd_pas_cicatrices','abd_pas_circulation_collaterale','abd_pas_voussures_vergetures','abd_ombilic_plisse','abd_teguments_normaux','abd_pas_asterixis','abd_pas_leuconychie_erytheme','abd_souple_depressible','abd_pas_defense_contracture','abd_pas_organomegalie','abd_hepatomegalie','abd_splenomegalie','abd_pas_contact_lombaire','abd_pas_masse_palpable','abd_pas_hernie','abd_pas_signe_flot','abd_pas_matite','abd_tympanisme_normal','abd_pas_meteorisme','abd_transit_audible','abd_pas_souffle_abdominal']);
    addRow('Zone douloureuse','abd_zone_douloureuse');
    const fleche=v('abd_fleche_hepatique');if(fleche)children.push(row('Fl√®che h√©patique',fleche+' cm'));
    addChecks(['tr_non_realise','tr_fissures','tr_hemorroides','tr_cri_douglas']);addRow('TR','tr_details');
    addH2('5.4 ‚Äî Examen Cardiaque');
    addChecks(['card_pas_hippocratisme','card_pas_xanthomes','card_trc_normal','card_pas_jvp','card_pas_cyanose_centrale','ep_card_insp_thorax_symetrique','ep_card_insp_pas_circulation','ep_card_insp_pas_oedeme_mi','ep_card_palp_choc_pointe','ep_card_palp_harzer_negatif','ep_card_palp_pas_thrill','ep_card_palp_pas_reflux','ep_card_ausc_bruits_coeur_percus','ep_card_ausc_systole_diastole_libres','ep_card_ausc_pas_frottement','ep_card_ausc_pas_sons_surajoutes','ep_card_pas_insuffisance']);
    addRow('Rythme / Souffle','ep_card_details');
    addH2('5.5 ‚Äî Examen Pulmonaire');
    addChecks(['pulm_thorax_symetrique','pulm_pas_tirage','pulm_pas_cyanose','pulm_vv_normaux','pulm_mv_bilateral','pulm_pas_rales','pulm_pas_matite','pulm_pas_frottement_pleural']);addRow('Pr√©cisions','pulm_details');
    addH2('5.6 ‚Äî Examen Neurologique');
    addChecks(['ep_neuro_conscient','ep_neuro_oriente_tps_espace','ep_neuro_pas_confusion','ep_neuro_pas_deficit_moteur','ep_neuro_pas_deficit_sensitif','ep_neuro_pas_ataxie','ep_neuro_babinski_negatif','ep_neuro_rot_present','ep_neuro_pas_clonus']);
    addRow('ROT','ep_neuro_rot_details');
    addChecks(['ep_neuro_nuque_souple','ep_neuro_kernig','ep_neuro_brudzinski','ep_cerv_insp_normal','ep_cerv_thyroide_normale','ep_cerv_pas_adp']);
    addH2('5.7 ‚Äî Examen Ost√©o-Articulaire');
    const dloc=v('ep_oa_douleur_localisation');if(dloc)children.push(row('Localisation',dloc));
    const evaoa=v('ep_oa_intensite_eva');if(evaoa)children.push(row('EVA',evaoa+'/10'));
    if(isChecked('ep_oa_raideur_matinale'))children.push(checkRow('Raideur matinale pr√©sente'));addRow('Pr√©cisions','ep_oa_details');
    addH2('5.8 ‚Äî Examen Uro-G√©nital');
    addChecks(['ep_ug_pas_globe_vesical','ep_ug_pas_douleur_fosaillon','ep_ug_giordano_negatif']);addRow('Pr√©cisions','ep_ug_details');
    addH2('5.9 ‚Äî Examen Cutan√© & Buccal');
    addChecks(['ep_cut_normal','ep_cut_pas_paleur','ep_cut_pas_ictere','ep_cut_pas_cyanose2']);addRow('L√©sions cutan√©es','ep_cut_lesions');
    if(isChecked('ep_cb_normal'))children.push(checkRow('Cavit√© buccale sans anomalie'));
    addRow('Anomalies buccales','ep_cb_anomalies');addRow('Autres examens','exam_autres');

    // VI - Conclusion
    addH1('VI. Conclusion Clinique & Hypoth√®ses Diagnostiques');
    addRow('R√©sum√© clinique','cc_resume_clinique');
    addRow("et chez qui l'examen clinique objective",'cc_signes_physiques');
    addRow('Signes fonctionnels r√©sum√©s','cc_signes_fonctionnels');
    // Diagnosis table
    children.push(new Paragraph({children:[new TextRun({text:'Hypoth√®ses diagnostiques :',bold:true,size:22,color:'0d3d72'})],spacing:{before:240,after:80}}));
    const diagRows = getDiagRows();
    if(diagRows.length>0){
      const tableRows=[new TableRow({children:[
        new TableCell({children:[new Paragraph({children:[new TextRun({text:'Hypoth√®se Diagnostique',bold:true,color:'FFFFFF',size:18})]})],shading:{fill:'1a5fa8'},width:{size:2500,type:WidthType.DXA}}),
        new TableCell({children:[new Paragraph({children:[new TextRun({text:'Arguments Pour',bold:true,color:'FFFFFF',size:18})]})],shading:{fill:'1a5fa8'},width:{size:3000,type:WidthType.DXA}}),
        new TableCell({children:[new Paragraph({children:[new TextRun({text:'Arguments Contre',bold:true,color:'FFFFFF',size:18})]})],shading:{fill:'1a5fa8'},width:{size:3000,type:WidthType.DXA}})
      ]})];
      diagRows.forEach((r,i)=>{
        tableRows.push(new TableRow({children:[
          new TableCell({children:[new Paragraph({children:[new TextRun({text:`Hypoth√®se ${i+1} : ${r.hyp}`,bold:true,size:18})]})],width:{size:2500,type:WidthType.DXA}}),
          new TableCell({children:[new Paragraph({children:[new TextRun({text:r.pour||'‚Äî',size:18})]})],width:{size:3000,type:WidthType.DXA}}),
          new TableCell({children:[new Paragraph({children:[new TextRun({text:r.contre||'‚Äî',size:18})]})],width:{size:3000,type:WidthType.DXA}})
        ]}));
      });
      children.push(new Table({rows:tableRows,width:{size:8500,type:WidthType.DXA}}));
    }

    // VII
    addH1('VII. CAT ‚Äî Conduite √Ä Tenir');
    addH2('Diagnostique');addChecks(['cat_biologie','cat_imagerie','cat_autres_examens']);addRow('Examens','cat_examens_details');
    addH2('Th√©rapeutique');addChecks(['cat_ther_etiologique','cat_ther_symptomatique','cat_ther_mesures_hygiene','cat_ther_surveillance','cat_ther_education']);addRow('Traitement','cat_traitement_details');
    // Signature
    children.push(new Paragraph({alignment:AlignmentType.RIGHT,spacing:{before:600},children:[new TextRun({text:(v('clinicien_nom')||'Nom Pr√©nom')+' ‚Äî '+(v('clinicien_fonction')||'Fonction'),bold:true,size:20})]}));

    const doc = new Document({creator:'Observation M√©dicale',title:'Observation M√©dicale',sections:[{properties:{},children}]});
    const blob = await Packer.toBlob(doc);
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    const patient = v('nom_prenom').replace(/\s+/g,'_')||'Patient';
    a.href=url; a.download=`Observation_${patient}_${new Date().toISOString().split('T')[0]}.docx`;
    a.click(); URL.revokeObjectURL(url);
    showToast('‚úÖ Fichier Word t√©l√©charg√© !');
  } catch(err) { console.error(err); showToast('‚ùå Erreur : '+err.message); }
  btn.disabled=false; btn.textContent='üìÑ Word';
}

// ‚îÄ‚îÄ‚îÄ Google Docs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function generateGoogleDocs() {
  const text = buildObservationText();
  navigator.clipboard.writeText(text).then(()=>{
    showToast('üìã Texte copi√© ! Collez dans Google Docs.');
    setTimeout(()=>window.open('https://docs.new','_blank'),800);
  }).catch(()=>{
    const ta=document.createElement('textarea');
    ta.value=text;ta.style.cssText='position:fixed;top:0;left:0;width:100%;height:60%;z-index:9999;font-size:12px;padding:10px;';
    document.body.appendChild(ta);ta.select();document.execCommand('copy');
    showToast('üìã Texte copi√© ! Ouvrez Google Docs et collez.');
    setTimeout(()=>document.body.removeChild(ta),200);
    setTimeout(()=>window.open('https://docs.new','_blank'),900);
  });
}

// ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
updateProgress();
</script>
</body>
</html>